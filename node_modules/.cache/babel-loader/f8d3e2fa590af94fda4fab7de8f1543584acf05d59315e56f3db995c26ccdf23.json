{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"bg-white p-6 rounded-lg shadow-md\"\n};\nconst _hoisted_2 = {\n  class: \"flex justify-between items-center mb-4\"\n};\nconst _hoisted_3 = {\n  class: \"space-x-4\"\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"text-center text-gray-600\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"text-gray-600\"\n};\nconst _hoisted_6 = {\n  key: 2,\n  class: \"space-y-4\"\n};\nconst _hoisted_7 = {\n  class: \"text-lg font-medium text-gray-700\"\n};\nconst _hoisted_8 = {\n  class: \"text-sm text-gray-500\"\n};\nconst _hoisted_9 = {\n  class: \"text-sm text-gray-500\"\n};\nconst _hoisted_10 = [\"href\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[2] || (_cache[2] = _createElementVNode(\"h2\", {\n    class: \"text-xl font-semibold text-gray-800\"\n  }, \"Lista de Cartones\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.downloadReport && $options.downloadReport(...args)),\n    class: \"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition\"\n  }, \" Descargar Reporte \"), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.loadCartones && $options.loadCartones(...args)),\n    class: \"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition\"\n  }, \" Refrescar \")])]), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \"Cargando cartones...\")) : $data.cartones.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, \"No hay cartones registrados.\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.cartones, carton => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: carton.id,\n      class: \"border p-4 rounded-md flex justify-between items-center\"\n    }, [_createElementVNode(\"div\", null, [_createElementVNode(\"p\", _hoisted_7, _toDisplayString(carton.serial), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_8, \"Estado: \" + _toDisplayString(carton.estado), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_9, \"Vendedor: \" + _toDisplayString(carton.vendedorId || 'No asignado'), 1 /* TEXT */), _createElementVNode(\"a\", {\n      href: carton.imageUrl,\n      target: \"_blank\",\n      class: \"text-blue-600 hover:underline\"\n    }, \"Ver Imagen\", 8 /* PROPS */, _hoisted_10)])]);\n  }), 128 /* KEYED_FRAGMENT */))]))]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","onClick","_cache","args","$options","downloadReport","loadCartones","$data","loading","_hoisted_4","cartones","length","_hoisted_5","_hoisted_6","_Fragment","_renderList","carton","id","_hoisted_7","_toDisplayString","serial","_hoisted_8","estado","_hoisted_9","vendedorId","href","imageUrl","target","_hoisted_10"],"sources":["D:\\Lotweb\\venta-cartones\\src\\components\\CartonList.vue"],"sourcesContent":["<template>\r\n  <div class=\"bg-white p-6 rounded-lg shadow-md\">\r\n    <div class=\"flex justify-between items-center mb-4\">\r\n      <h2 class=\"text-xl font-semibold text-gray-800\">Lista de Cartones</h2>\r\n      <div class=\"space-x-4\">\r\n        <button\r\n          @click=\"downloadReport\"\r\n          class=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition\"\r\n        >\r\n          Descargar Reporte\r\n        </button>\r\n        <button\r\n          @click=\"loadCartones\"\r\n          class=\"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition\"\r\n        >\r\n          Refrescar\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div v-if=\"loading\" class=\"text-center text-gray-600\">Cargando cartones...</div>\r\n    <div v-else-if=\"cartones.length === 0\" class=\"text-gray-600\">No hay cartones registrados.</div>\r\n    <div v-else class=\"space-y-4\">\r\n      <div v-for=\"carton in cartones\" :key=\"carton.id\" class=\"border p-4 rounded-md flex justify-between items-center\">\r\n        <div>\r\n          <p class=\"text-lg font-medium text-gray-700\">{{ carton.serial }}</p>\r\n          <p class=\"text-sm text-gray-500\">Estado: {{ carton.estado }}</p>\r\n          <p class=\"text-sm text-gray-500\">Vendedor: {{ carton.vendedorId || 'No asignado' }}</p>\r\n          <a :href=\"carton.imageUrl\" target=\"_blank\" class=\"text-blue-600 hover:underline\">Ver Imagen</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { db } from '../firebase';\r\nimport { collection, query, onSnapshot } from 'firebase/firestore';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      cartones: [],\r\n      loading: false,\r\n      unsubscribe: null\r\n    };\r\n  },\r\n  mounted() {\r\n    this.loadCartones();\r\n  },\r\n  beforeUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n  },\r\n  methods: {\r\n    loadCartones() {\r\n      this.loading = true;\r\n      const cartonesRef = collection(db, 'cartones');\r\n      const q = query(cartonesRef);\r\n\r\n      // Usamos onSnapshot para escuchar cambios en tiempo real\r\n      this.unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n        this.cartones = querySnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n        this.cartones.sort((a, b) => {\r\n          const serialA = parseInt(a.serial.replace('LM', ''), 10);\r\n          const serialB = parseInt(b.serial.replace('LM', ''), 10);\r\n          return serialA - serialB;\r\n        });\r\n        this.loading = false;\r\n      }, (error) => {\r\n        console.error('Error al escuchar cartones:', error);\r\n        alert('Error al cargar cartones: ' + error.message);\r\n        this.loading = false;\r\n      });\r\n    },\r\n    async downloadReport() {\r\n      try {\r\n        const reportData = this.cartones.map(carton => ({\r\n          Serial: carton.serial,\r\n          Estado: carton.estado,\r\n          Vendedor: carton.vendedorId || 'No asignado',\r\n          Imagen: carton.imageUrl\r\n        }));\r\n        const csvContent = [\r\n          ['Serial', 'Estado', 'Vendedor', 'Imagen'],\r\n          ...reportData.map(item => [\r\n            item.Serial,\r\n            item.Estado,\r\n            item.Vendedor,\r\n            item.Imagen\r\n          ])\r\n        ].map(row => row.join(',')).join('\\n');\r\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement('a');\r\n        link.setAttribute('href', url);\r\n        link.setAttribute('download', 'reporte_cartones.csv');\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n      } catch (error) {\r\n        console.error('Error al generar el reporte:', error);\r\n        alert('Error al generar el reporte: ' + error.message);\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* Tailwind maneja los estilos */\r\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAmC;;EACvCA,KAAK,EAAC;AAAwC;;EAE5CA,KAAK,EAAC;AAAW;;EAJ5BC,GAAA;EAmBwBD,KAAK,EAAC;;;EAnB9BC,GAAA;EAoB2CD,KAAK,EAAC;;;EApBjDC,GAAA;EAqBgBD,KAAK,EAAC;;;EAGTA,KAAK,EAAC;AAAmC;;EACzCA,KAAK,EAAC;AAAuB;;EAC7BA,KAAK,EAAC;AAAuB;oBA1B1C;;uBACEE,mBAAA,CA8BM,OA9BNC,UA8BM,GA7BJC,mBAAA,CAgBM,OAhBNC,UAgBM,G,0BAfJD,mBAAA,CAAsE;IAAlEJ,KAAK,EAAC;EAAqC,GAAC,mBAAiB,sBACjEI,mBAAA,CAaM,OAbNE,UAaM,GAZJF,mBAAA,CAKS;IAJNG,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,cAAA,IAAAD,QAAA,CAAAC,cAAA,IAAAF,IAAA,CAAc;IACtBT,KAAK,EAAC;KACP,qBAED,GACAI,mBAAA,CAKS;IAJNG,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAE,YAAA,IAAAF,QAAA,CAAAE,YAAA,IAAAH,IAAA,CAAY;IACpBT,KAAK,EAAC;KACP,aAED,E,KAGOa,KAAA,CAAAC,OAAO,I,cAAlBZ,mBAAA,CAAgF,OAAhFa,UAAgF,EAA1B,sBAAoB,KAC1DF,KAAA,CAAAG,QAAQ,CAACC,MAAM,U,cAA/Bf,mBAAA,CAA+F,OAA/FgB,UAA+F,EAAlC,8BAA4B,M,cACzFhB,mBAAA,CASM,OATNiB,UASM,I,kBARJjB,mBAAA,CAOMkB,SAAA,QA7BZC,WAAA,CAsB4BR,KAAA,CAAAG,QAAQ,EAAlBM,MAAM;yBAAlBpB,mBAAA,CAOM;MAP2BD,GAAG,EAAEqB,MAAM,CAACC,EAAE;MAAEvB,KAAK,EAAC;QACrDI,mBAAA,CAKM,cAJJA,mBAAA,CAAoE,KAApEoB,UAAoE,EAAAC,gBAAA,CAApBH,MAAM,CAACI,MAAM,kBAC7DtB,mBAAA,CAAgE,KAAhEuB,UAAgE,EAA/B,UAAQ,GAAAF,gBAAA,CAAGH,MAAM,CAACM,MAAM,kBACzDxB,mBAAA,CAAuF,KAAvFyB,UAAuF,EAAtD,YAAU,GAAAJ,gBAAA,CAAGH,MAAM,CAACQ,UAAU,mCAC/D1B,mBAAA,CAA+F;MAA3F2B,IAAI,EAAET,MAAM,CAACU,QAAQ;MAAEC,MAAM,EAAC,QAAQ;MAACjC,KAAK,EAAC;OAAgC,YAAU,iBA3BrGkC,WAAA,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}