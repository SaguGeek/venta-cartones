{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  class: \"bg-white p-6 rounded-lg shadow-md mb-6\"\n};\nconst _hoisted_2 = {\n  class: \"flex flex-col items-center\"\n};\nconst _hoisted_3 = [\"disabled\"];\nconst _hoisted_4 = {\n  key: 0,\n  class: \"flex items-center\"\n};\nconst _hoisted_5 = {\n  key: 1\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"mt-4\"\n};\nconst _hoisted_7 = {\n  class: \"mt-2\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\"\n};\nconst _hoisted_9 = {\n  class: \"bg-white p-6 rounded-lg shadow-lg max-w-md w-full\"\n};\nconst _hoisted_10 = {\n  class: \"w-full bg-gray-200 rounded-full h-4 mb-2\"\n};\nconst _hoisted_11 = {\n  class: \"text-center text-gray-700\"\n};\nconst _hoisted_12 = [\"disabled\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[6] || (_cache[6] = _createElementVNode(\"h2\", {\n    class: \"text-2xl font-semibold text-gray-800 mb-4\"\n  }, \"Subir Cartones\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"input\", {\n    type: \"file\",\n    onChange: _cache[0] || (_cache[0] = (...args) => $options.onFileChange && $options.onFileChange(...args)),\n    accept: \"image/*\",\n    multiple: \"\",\n    class: \"mb-4 p-2 border rounded-md w-full max-w-md\"\n  }, null, 32 /* NEED_HYDRATION */), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.checkAndUploadImages && $options.checkAndUploadImages(...args)),\n    class: \"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition flex items-center justify-center\",\n    disabled: $data.uploading || !$data.selectedFiles.length\n  }, [$data.uploading ? (_openBlock(), _createElementBlock(\"span\", _hoisted_4, _cache[3] || (_cache[3] = [_createElementVNode(\"svg\", {\n    class: \"animate-spin h-5 w-5 mr-2 text-white\",\n    viewBox: \"0 0 24 24\"\n  }, [_createElementVNode(\"circle\", {\n    class: \"opacity-25\",\n    cx: \"12\",\n    cy: \"12\",\n    r: \"10\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"4\"\n  }), _createElementVNode(\"path\", {\n    class: \"opacity-75\",\n    fill: \"currentColor\",\n    d: \"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n  })], -1 /* HOISTED */), _createTextVNode(\" Subiendo... \")]))) : (_openBlock(), _createElementBlock(\"span\", _hoisted_5, \"Subir Imágenes\"))], 8 /* PROPS */, _hoisted_3)]), $data.duplicates.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", {\n    class: \"text-lg font-medium text-red-600\"\n  }, \"Archivos ya existentes:\", -1 /* HOISTED */)), _createElementVNode(\"ul\", _hoisted_7, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.duplicates, duplicate => {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: duplicate,\n      class: \"text-red-600\"\n    }, _toDisplayString(duplicate), 1 /* TEXT */);\n  }), 128 /* KEYED_FRAGMENT */))])])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Modal de Progreso \"), $data.showProgressModal ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [_createElementVNode(\"div\", _hoisted_9, [_cache[5] || (_cache[5] = _createElementVNode(\"h3\", {\n    class: \"text-xl font-semibold text-gray-800 mb-4\"\n  }, \"Subiendo Imágenes\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"div\", {\n    class: \"bg-blue-600 h-4 rounded-full transition-all duration-300\",\n    style: _normalizeStyle({\n      width: $data.progress + '%'\n    })\n  }, null, 4 /* STYLE */)]), _createElementVNode(\"p\", _hoisted_11, _toDisplayString($data.uploadedCount) + \" de \" + _toDisplayString($data.totalFiles) + \" subidas\", 1 /* TEXT */), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.closeProgressModal && $options.closeProgressModal(...args)),\n    class: \"mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition\",\n    disabled: $data.uploading\n  }, \" Cerrar \", 8 /* PROPS */, _hoisted_12)])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","type","onChange","_cache","args","$options","onFileChange","accept","multiple","onClick","checkAndUploadImages","disabled","$data","uploading","selectedFiles","length","_hoisted_4","viewBox","cx","cy","r","stroke","fill","d","_createTextVNode","_hoisted_5","_hoisted_3","duplicates","_hoisted_6","_hoisted_7","_Fragment","_renderList","duplicate","_createCommentVNode","showProgressModal","_hoisted_8","_hoisted_9","_hoisted_10","style","_normalizeStyle","width","progress","_hoisted_11","_toDisplayString","uploadedCount","totalFiles","closeProgressModal","_hoisted_12"],"sources":["D:\\Lotweb\\venta-cartones\\src\\components\\UploadCarton.vue"],"sourcesContent":["<template>\r\n  <div class=\"bg-white p-6 rounded-lg shadow-md mb-6\">\r\n    <h2 class=\"text-2xl font-semibold text-gray-800 mb-4\">Subir Cartones</h2>\r\n    <div class=\"flex flex-col items-center\">\r\n      <input\r\n        type=\"file\"\r\n        @change=\"onFileChange\"\r\n        accept=\"image/*\"\r\n        multiple\r\n        class=\"mb-4 p-2 border rounded-md w-full max-w-md\"\r\n      />\r\n      <button\r\n        @click=\"checkAndUploadImages\"\r\n        class=\"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition flex items-center justify-center\"\r\n        :disabled=\"uploading || !selectedFiles.length\"\r\n      >\r\n        <span v-if=\"uploading\" class=\"flex items-center\">\r\n          <svg class=\"animate-spin h-5 w-5 mr-2 text-white\" viewBox=\"0 0 24 24\">\r\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n          </svg>\r\n          Subiendo...\r\n        </span>\r\n        <span v-else>Subir Imágenes</span>\r\n      </button>\r\n    </div>\r\n    <div v-if=\"duplicates.length > 0\" class=\"mt-4\">\r\n      <h3 class=\"text-lg font-medium text-red-600\">Archivos ya existentes:</h3>\r\n      <ul class=\"mt-2\">\r\n        <li v-for=\"duplicate in duplicates\" :key=\"duplicate\" class=\"text-red-600\">{{ duplicate }}</li>\r\n      </ul>\r\n    </div>\r\n    <!-- Modal de Progreso -->\r\n    <div v-if=\"showProgressModal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div class=\"bg-white p-6 rounded-lg shadow-lg max-w-md w-full\">\r\n        <h3 class=\"text-xl font-semibold text-gray-800 mb-4\">Subiendo Imágenes</h3>\r\n        <div class=\"w-full bg-gray-200 rounded-full h-4 mb-2\">\r\n          <div\r\n            class=\"bg-blue-600 h-4 rounded-full transition-all duration-300\"\r\n            :style=\"{ width: progress + '%' }\"\r\n          ></div>\r\n        </div>\r\n        <p class=\"text-center text-gray-700\">{{ uploadedCount }} de {{ totalFiles }} subidas</p>\r\n        <button\r\n          @click=\"closeProgressModal\"\r\n          class=\"mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition\"\r\n          :disabled=\"uploading\"\r\n        >\r\n          Cerrar\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      selectedFiles: [],\r\n      uploadedUrls: [],\r\n      duplicates: [],\r\n      uploadErrors: [],\r\n      uploading: false,\r\n      uploadedCount: 0,\r\n      totalFiles: 0,\r\n      progress: 0,\r\n      showProgressModal: false,\r\n      cloudinaryUrl: 'https://api.cloudinary.com/v1_1/dardyvsja/image/upload',\r\n      uploadPreset: 'cartones_upload'\r\n    };\r\n  },\r\n  methods: {\r\n    onFileChange(event) {\r\n      this.selectedFiles = Array.from(event.target.files);\r\n      this.uploadedUrls = [];\r\n      this.duplicates = [];\r\n      this.uploadErrors = [];\r\n      this.showProgressModal = false;\r\n    },\r\n    async checkAndUploadImages() {\r\n      if (this.selectedFiles.length === 0) {\r\n        alert('Por favor, selecciona al menos una imagen.');\r\n        return;\r\n      }\r\n\r\n      this.uploading = true;\r\n      this.totalFiles = this.selectedFiles.length;\r\n      this.uploadedCount = 0;\r\n      this.progress = 0;\r\n      this.showProgressModal = true;\r\n\r\n      const serials = this.selectedFiles.map(file => file.name.split('.')[0]);\r\n      const self = this; // Guardamos el contexto de 'this'\r\n\r\n      this.$emit('check-duplicates', { serials, files: this.selectedFiles }, async (nonDuplicates) => {\r\n        try {\r\n          if (!Array.isArray(nonDuplicates)) {\r\n            throw new Error('La respuesta de duplicados no es válida.');\r\n          }\r\n\r\n          if (nonDuplicates.length === 0) {\r\n            alert('Todos los archivos seleccionados ya existen.');\r\n            self.uploading = false;\r\n            self.showProgressModal = false;\r\n            return;\r\n          }\r\n\r\n          self.duplicates = self.selectedFiles\r\n            .filter(file => !nonDuplicates.some(nd => nd.name === file.name))\r\n            .map(file => file.name);\r\n\r\n          const uploadPromises = nonDuplicates.map(async (file) => {\r\n            const serial = file.name.split('.')[0];\r\n            const formData = new FormData();\r\n            formData.append('file', file);\r\n            formData.append('upload_preset', self.uploadPreset);\r\n\r\n            try {\r\n              const response = await fetch(self.cloudinaryUrl, {\r\n                method: 'POST',\r\n                body: formData\r\n              });\r\n              const data = await response.json();\r\n              if (data.secure_url) {\r\n                self.uploadedUrls.push(data.secure_url);\r\n                self.uploadedCount++;\r\n                self.progress = Math.round((self.uploadedCount / self.totalFiles) * 100);\r\n                return { serial, imageUrl: data.secure_url };\r\n              } else {\r\n                throw new Error(`Error al subir ${file.name}: ${JSON.stringify(data)}`);\r\n              }\r\n            } catch (error) {\r\n              console.error(`Error al subir ${file.name}:`, error);\r\n              return null;\r\n            }\r\n          });\r\n\r\n          const results = await Promise.all(uploadPromises);\r\n          const validResults = results.filter(result => result !== null);\r\n          if (validResults.length > 0) {\r\n            self.$emit('images-uploaded', validResults);\r\n            alert(`${validResults.length} de ${nonDuplicates.length} imágenes subidas correctamente.`);\r\n          } else {\r\n            alert('No se subieron imágenes correctamente.');\r\n          }\r\n        } catch (error) {\r\n          console.error('Error en el proceso de subida:', error);\r\n          alert('Error en el proceso de subida: ' + error.message);\r\n        } finally {\r\n          self.uploading = false;\r\n          self.progress = 100;\r\n          setTimeout(() => {\r\n            self.showProgressModal = false;\r\n          }, 1000); // Mantener el modal visible por 1 segundo al terminar\r\n        }\r\n      });\r\n    },\r\n    closeProgressModal() {\r\n      if (!this.uploading) {\r\n        this.showProgressModal = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* Tailwind maneja los estilos */\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}