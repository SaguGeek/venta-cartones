{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport UploadCarton from '../components/UploadCarton.vue';\nimport AssignCartons from '../components/AssignCartons.vue';\nimport CartonList from '../components/CartonList.vue';\nimport SellerList from '../components/SellerList.vue';\nimport { db } from '../firebase';\nimport { collection, query, where, getDocs, addDoc } from 'firebase/firestore';\nimport { auth } from '../firebase';\nimport { signOut } from 'firebase/auth';\nexport default {\n  name: 'HomePage',\n  components: {\n    UploadCarton,\n    AssignCartons,\n    CartonList,\n    SellerList\n  },\n  data() {\n    return {\n      inactivityTimeout: null,\n      inactivityLimit: 15 * 60 * 1000 // 15 minutos en milisegundos\n    };\n  },\n  mounted() {\n    this.setupInactivityTimer();\n  },\n  beforeUnmount() {\n    this.clearInactivityTimer();\n  },\n  methods: {\n    async checkDuplicates({\n      serials,\n      files\n    }, callback) {\n      try {\n        const cartonesRef = collection(db, 'cartones');\n        const q = query(cartonesRef, where('serial', 'in', serials));\n        const querySnapshot = await getDocs(q);\n        const existingSerials = querySnapshot.docs.map(doc => doc.data().serial);\n        const nonDuplicates = files.filter(file => !existingSerials.includes(file.name.split('.')[0]));\n        callback(nonDuplicates);\n      } catch (error) {\n        console.error('Error al verificar duplicados:', error);\n        alert('Error al verificar duplicados: ' + error.message);\n        callback([]);\n      }\n    },\n    async handleImagesUploaded(images) {\n      let successCount = 0;\n      try {\n        for (const image of images) {\n          if (image.serial && image.imageUrl) {\n            const docRef = await addDoc(collection(db, 'cartones'), {\n              serial: image.serial,\n              imageUrl: image.imageUrl,\n              estado: 'disponible',\n              createdAt: new Date(),\n              vendedorId: null\n            });\n            console.log(`Cartón ${image.serial} guardado con ID:`, docRef.id);\n            successCount++;\n          } else if (typeof image === 'string') {\n            const serial = this.selectedFiles.find(file => file.name.includes(image.split('/').pop().split('.')[0]))?.name.split('.')[0];\n            if (serial) {\n              const docRef = await addDoc(collection(db, 'cartones'), {\n                serial: serial,\n                imageUrl: image,\n                estado: 'disponible',\n                createdAt: new Date(),\n                vendedorId: null\n              });\n              console.log(`Cartón ${serial} guardado con ID:`, docRef.id);\n              successCount++;\n            }\n          }\n        }\n        alert(`${successCount} de ${images.length} cartones se guardaron exitosamente en Firestore`);\n      } catch (error) {\n        console.error('Error al guardar los cartones:', error);\n        alert(`Error al guardar los cartones: ${error.message}. Se guardaron ${successCount} de ${images.length} cartones.`);\n      }\n    },\n    async refreshCartones() {\n      if (this.$refs.cartonList && typeof this.$refs.cartonList.loadCartones === 'function') {\n        await this.$refs.cartonList.loadCartones();\n      } else {\n        console.warn('loadCartones no está disponible en CartonList');\n      }\n    },\n    async logout() {\n      try {\n        await signOut(auth);\n        this.$router.push('/login');\n        console.log('Sesión cerrada con éxito');\n        this.clearInactivityTimer();\n      } catch (error) {\n        console.error('Error al cerrar sesión:', error);\n        alert('Error al cerrar sesión: ' + error.message);\n      }\n    },\n    setupInactivityTimer() {\n      // Eventos que indican actividad del usuario\n      const events = ['mousemove', 'keydown', 'click', 'scroll'];\n      const resetTimer = () => {\n        this.clearInactivityTimer();\n        this.inactivityTimeout = setTimeout(() => {\n          this.logout();\n          alert('Sesión cerrada por inactividad de 15 minutos.');\n        }, this.inactivityLimit);\n      };\n\n      // Añadir listeners para los eventos\n      events.forEach(event => {\n        window.addEventListener(event, resetTimer);\n      });\n\n      // Iniciar el temporizador al montar el componente\n      resetTimer();\n    },\n    clearInactivityTimer() {\n      const events = ['mousemove', 'keydown', 'click', 'scroll'];\n      events.forEach(event => {\n        window.removeEventListener(event, () => {});\n      });\n      if (this.inactivityTimeout) {\n        clearTimeout(this.inactivityTimeout);\n        this.inactivityTimeout = null;\n      }\n    }\n  }\n};","map":{"version":3,"names":["UploadCarton","AssignCartons","CartonList","SellerList","db","collection","query","where","getDocs","addDoc","auth","signOut","name","components","data","inactivityTimeout","inactivityLimit","mounted","setupInactivityTimer","beforeUnmount","clearInactivityTimer","methods","checkDuplicates","serials","files","callback","cartonesRef","q","querySnapshot","existingSerials","docs","map","doc","serial","nonDuplicates","filter","file","includes","split","error","console","alert","message","handleImagesUploaded","images","successCount","image","imageUrl","docRef","estado","createdAt","Date","vendedorId","log","id","selectedFiles","find","pop","length","refreshCartones","$refs","cartonList","loadCartones","warn","logout","$router","push","events","resetTimer","setTimeout","forEach","event","window","addEventListener","removeEventListener","clearTimeout"],"sources":["D:\\Lotweb\\venta-cartones\\src\\views\\HomePage.vue"],"sourcesContent":["<template>\r\n  <div class=\"min-h-screen bg-gradient-to-br from-gray-900 via-indigo-900 to-purple-900\">\r\n    <!-- Barra de Navegación -->\r\n    <header class=\"bg-gray-800 bg-opacity-90 shadow-xl sticky top-0 z-50 backdrop-blur-md\">\r\n      <div class=\"container mx-auto px-6 py-4 flex justify-between items-center\">\r\n        <div class=\"flex items-center space-x-4\">\r\n          <span class=\"text-3xl font-extrabold text-purple-400 animate-pulse\">VC</span>\r\n          <h1 class=\"text-2xl font-bold text-white tracking-wide\">Dashboard Admin</h1>\r\n        </div>\r\n        <button\r\n          @click=\"logout\"\r\n          class=\"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-5 py-2 rounded-full hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-purple-400 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105\"\r\n        >\r\n          Cerrar Sesión\r\n        </button>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- Contenido Principal -->\r\n    <main class=\"container mx-auto px-6 py-10\">\r\n      <div class=\"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8\">\r\n        <!-- Sección de Subir Cartones -->\r\n        <div class=\"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2\">\r\n          <h2 class=\"text-2xl font-semibold text-gray-800 mb-6 tracking-tight\">Subir Cartones</h2>\r\n          <UploadCarton @check-duplicates=\"checkDuplicates\" @images-uploaded=\"handleImagesUploaded\" />\r\n        </div>\r\n\r\n        <!-- Sección de Asignar Cartones -->\r\n        <div class=\"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2\">\r\n          <h2 class=\"text-2xl font-semibold text-gray-800 mb-6 tracking-tight\">Asignar Cartones</h2>\r\n          <AssignCartons @cartones-asignados=\"refreshCartones\" />\r\n        </div>\r\n\r\n        <!-- Sección de Lista de Cartones -->\r\n        <div class=\"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2\">\r\n          <h2 class=\"text-2xl font-semibold text-gray-800 mb-6 tracking-tight\">Lista de Cartones</h2>\r\n          <CartonList ref=\"cartonList\" />\r\n        </div>\r\n\r\n        <!-- Sección de Lista de Vendedores -->\r\n        <div class=\"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2\">\r\n          <h2 class=\"text-2xl font-semibold text-gray-800 mb-6 tracking-tight\">Lista de Vendedores</h2>\r\n          <SellerList />\r\n        </div>\r\n      </div>\r\n    </main>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport UploadCarton from '../components/UploadCarton.vue';\r\nimport AssignCartons from '../components/AssignCartons.vue';\r\nimport CartonList from '../components/CartonList.vue';\r\nimport SellerList from '../components/SellerList.vue';\r\nimport { db } from '../firebase';\r\nimport { collection, query, where, getDocs, addDoc } from 'firebase/firestore';\r\nimport { auth } from '../firebase';\r\nimport { signOut } from 'firebase/auth';\r\n\r\nexport default {\r\n  name: 'HomePage',\r\n  components: {\r\n    UploadCarton,\r\n    AssignCartons,\r\n    CartonList,\r\n    SellerList\r\n  },\r\n  data() {\r\n    return {\r\n      inactivityTimeout: null,\r\n      inactivityLimit: 15 * 60 * 1000 // 15 minutos en milisegundos\r\n    };\r\n  },\r\n  mounted() {\r\n    this.setupInactivityTimer();\r\n  },\r\n  beforeUnmount() {\r\n    this.clearInactivityTimer();\r\n  },\r\n  methods: {\r\n    async checkDuplicates({ serials, files }, callback) {\r\n      try {\r\n        const cartonesRef = collection(db, 'cartones');\r\n        const q = query(cartonesRef, where('serial', 'in', serials));\r\n        const querySnapshot = await getDocs(q);\r\n        const existingSerials = querySnapshot.docs.map(doc => doc.data().serial);\r\n        const nonDuplicates = files.filter(file => !existingSerials.includes(file.name.split('.')[0]));\r\n        callback(nonDuplicates);\r\n      } catch (error) {\r\n        console.error('Error al verificar duplicados:', error);\r\n        alert('Error al verificar duplicados: ' + error.message);\r\n        callback([]);\r\n      }\r\n    },\r\n    async handleImagesUploaded(images) {\r\n      let successCount = 0;\r\n      try {\r\n        for (const image of images) {\r\n          if (image.serial && image.imageUrl) {\r\n            const docRef = await addDoc(collection(db, 'cartones'), {\r\n              serial: image.serial,\r\n              imageUrl: image.imageUrl,\r\n              estado: 'disponible',\r\n              createdAt: new Date(),\r\n              vendedorId: null\r\n            });\r\n            console.log(`Cartón ${image.serial} guardado con ID:`, docRef.id);\r\n            successCount++;\r\n          } else if (typeof image === 'string') {\r\n            const serial = this.selectedFiles.find(file => file.name.includes(image.split('/').pop().split('.')[0]))?.name.split('.')[0];\r\n            if (serial) {\r\n              const docRef = await addDoc(collection(db, 'cartones'), {\r\n                serial: serial,\r\n                imageUrl: image,\r\n                estado: 'disponible',\r\n                createdAt: new Date(),\r\n                vendedorId: null\r\n              });\r\n              console.log(`Cartón ${serial} guardado con ID:`, docRef.id);\r\n              successCount++;\r\n            }\r\n          }\r\n        }\r\n        alert(`${successCount} de ${images.length} cartones se guardaron exitosamente en Firestore`);\r\n      } catch (error) {\r\n        console.error('Error al guardar los cartones:', error);\r\n        alert(`Error al guardar los cartones: ${error.message}. Se guardaron ${successCount} de ${images.length} cartones.`);\r\n      }\r\n    },\r\n    async refreshCartones() {\r\n      if (this.$refs.cartonList && typeof this.$refs.cartonList.loadCartones === 'function') {\r\n        await this.$refs.cartonList.loadCartones();\r\n      } else {\r\n        console.warn('loadCartones no está disponible en CartonList');\r\n      }\r\n    },\r\n    async logout() {\r\n      try {\r\n        await signOut(auth);\r\n        this.$router.push('/login');\r\n        console.log('Sesión cerrada con éxito');\r\n        this.clearInactivityTimer();\r\n      } catch (error) {\r\n        console.error('Error al cerrar sesión:', error);\r\n        alert('Error al cerrar sesión: ' + error.message);\r\n      }\r\n    },\r\n    setupInactivityTimer() {\r\n      // Eventos que indican actividad del usuario\r\n      const events = ['mousemove', 'keydown', 'click', 'scroll'];\r\n      const resetTimer = () => {\r\n        this.clearInactivityTimer();\r\n        this.inactivityTimeout = setTimeout(() => {\r\n          this.logout();\r\n          alert('Sesión cerrada por inactividad de 15 minutos.');\r\n        }, this.inactivityLimit);\r\n      };\r\n\r\n      // Añadir listeners para los eventos\r\n      events.forEach(event => {\r\n        window.addEventListener(event, resetTimer);\r\n      });\r\n\r\n      // Iniciar el temporizador al montar el componente\r\n      resetTimer();\r\n    },\r\n    clearInactivityTimer() {\r\n      const events = ['mousemove', 'keydown', 'click', 'scroll'];\r\n      events.forEach(event => {\r\n        window.removeEventListener(event, () => {});\r\n      });\r\n      if (this.inactivityTimeout) {\r\n        clearTimeout(this.inactivityTimeout);\r\n        this.inactivityTimeout = null;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* Animación de pulso para el logo */\r\n.animate-pulse {\r\n  animation: pulse 2s infinite ease-in-out;\r\n}\r\n\r\n@keyframes pulse {\r\n  0% {\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n  50% {\r\n    transform: scale(1.2);\r\n    opacity: 0.7;\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Sombras personalizadas */\r\n.shadow-3xl {\r\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}