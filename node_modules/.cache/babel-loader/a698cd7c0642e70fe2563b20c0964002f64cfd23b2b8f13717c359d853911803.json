{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { db } from '../firebase';\nimport { collection, query, where, getDocs, doc, updateDoc } from 'firebase/firestore';\nexport default {\n  data() {\n    return {\n      sellers: [],\n      availableCartons: [],\n      selectedSeller: '',\n      fromCarton: '',\n      toCarton: '',\n      loading: false\n    };\n  },\n  async mounted() {\n    await this.loadSellers();\n    await this.loadAvailableCartons();\n  },\n  methods: {\n    async loadSellers() {\n      try {\n        console.log('Cargando vendedores...');\n        const querySnapshot = await getDocs(collection(db, 'vendedores'));\n        this.sellers = querySnapshot.docs.map(docSnapshot => {\n          const data = docSnapshot.data();\n          return {\n            id: docSnapshot.id,\n            ...data,\n            vendedorId: data.vendedorId || docSnapshot.id\n          };\n        });\n        console.log('Vendedores cargados:', this.sellers);\n      } catch (error) {\n        console.error('Error al cargar los vendedores:', error);\n        this.$toast.error('Error al cargar los vendedores: ' + error.message);\n      }\n    },\n    async loadAvailableCartons() {\n      try {\n        console.log('Cargando cartones disponibles...');\n        const q = query(collection(db, 'cartones'), where('vendedorId', '==', null), where('estado', '==', 'disponible'));\n        const querySnapshot = await getDocs(q);\n        this.availableCartons = querySnapshot.docs.map(doc => ({\n          id: doc.id,\n          serial: doc.data().serial\n        }));\n        // Ordenar los cartones por serial (LM seguido de números)\n        this.availableCartons.sort((a, b) => {\n          const serialA = parseInt(a.serial.replace('LM', ''), 10);\n          const serialB = parseInt(b.serial.replace('LM', ''), 10);\n          return serialA - serialB;\n        });\n        console.log('Cartones disponibles:', this.availableCartons);\n      } catch (error) {\n        console.error('Error al cargar cartones disponibles:', error);\n        this.$toast.error('Error al cargar cartones disponibles: ' + error.message);\n      }\n    },\n    async assignCartons() {\n      if (!this.selectedSeller || !this.fromCarton || !toCarton) return;\n      this.loading = true;\n      try {\n        console.log('Asignando cartones a vendedor:', this.selectedSeller, 'Desde:', this.fromCarton, 'Hasta:', this.toCarton);\n        const fromIndex = this.availableCartons.findIndex(carton => carton.id === this.fromCarton);\n        const toIndex = this.availableCartons.findIndex(carton => carton.id === this.toCarton);\n        if (fromIndex === -1 || toIndex === -1) {\n          throw new Error('Cartón inicial o final no encontrado');\n        }\n        const startIndex = Math.min(fromIndex, toIndex);\n        const endIndex = Math.max(fromIndex, toIndex);\n        const selectedCartons = this.availableCartons.slice(startIndex, endIndex + 1).map(carton => carton.id);\n        console.log('Cartones seleccionados en el rango:', selectedCartons);\n        const batch = [];\n        for (const cartonId of selectedCartons) {\n          const cartonRef = doc(db, 'cartones', cartonId);\n          batch.push(updateDoc(cartonRef, {\n            vendedorId: this.selectedSeller,\n            estado: 'asignado'\n          }));\n        }\n        await Promise.all(batch);\n        console.log('Cartones asignados exitosamente');\n        this.$toast.success('Cartones asignados exitosamente');\n        this.fromCarton = '';\n        this.toCarton = '';\n        await this.loadAvailableCartons();\n        this.$emit('cartones-asignados');\n      } catch (error) {\n        console.error('Error al asignar cartones:', error);\n        this.$toast.error('Error al asignar cartones: ' + (error.message || 'Error desconocido'));\n      } finally {\n        this.loading = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["db","collection","query","where","getDocs","doc","updateDoc","data","sellers","availableCartons","selectedSeller","fromCarton","toCarton","loading","mounted","loadSellers","loadAvailableCartons","methods","console","log","querySnapshot","docs","map","docSnapshot","id","vendedorId","error","$toast","message","q","serial","sort","a","b","serialA","parseInt","replace","serialB","assignCartons","fromIndex","findIndex","carton","toIndex","Error","startIndex","Math","min","endIndex","max","selectedCartons","slice","batch","cartonId","cartonRef","push","estado","Promise","all","success","$emit"],"sources":["D:\\Lotweb\\venta-cartones\\src\\components\\AssignCartons.vue"],"sourcesContent":["```vue\r\n<template>\r\n  <div class=\"space-y-4\">\r\n    <h2 class=\"text-xl font-semibold text-gray-800 mb-4\">Asignar Cartones por Lote</h2>\r\n    <form @submit.prevent=\"assignCartons\" class=\"space-y-4\">\r\n      <!-- Selección de Vendedor -->\r\n      <div>\r\n        <label for=\"seller\" class=\"block text-sm font-medium text-gray-700\">Seleccionar Vendedor</label>\r\n        <select\r\n          v-model=\"selectedSeller\"\r\n          id=\"seller\"\r\n          class=\"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300\"\r\n        >\r\n          <option value=\"\" disabled>Selecciona un vendedor</option>\r\n          <option v-for=\"seller in sellers\" :key=\"seller.id\" :value=\"seller.id\">{{ seller.nombre || seller.id }}</option>\r\n        </select>\r\n      </div>\r\n\r\n      <!-- Rango de Cartones Disponibles -->\r\n      <div class=\"flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0\">\r\n        <div class=\"w-full sm:w-1/2\">\r\n          <label for=\"fromCarton\" class=\"block text-sm font-medium text-gray-700\">Desde</label>\r\n          <select\r\n            v-model=\"fromCarton\"\r\n            id=\"fromCarton\"\r\n            class=\"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300\"\r\n          >\r\n            <option value=\"\" disabled>Selecciona un cartón</option>\r\n            <option v-for=\"carton in availableCartons\" :key=\"carton.id\" :value=\"carton.id\">{{ carton.serial }}</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"w-full sm:w-1/2\">\r\n          <label for=\"toCarton\" class=\"block text-sm font-medium text-gray-700\">Hasta</label>\r\n          <select\r\n            v-model=\"toCarton\"\r\n            id=\"toCarton\"\r\n            class=\"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300\"\r\n          >\r\n            <option value=\"\" disabled>Selecciona un cartón</option>\r\n            <option v-for=\"carton in availableCartons\" :key=\"carton.id\" :value=\"carton.id\">{{ carton.serial }}</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Botón de Asignar -->\r\n      <button\r\n        type=\"submit\"\r\n        class=\"w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300\"\r\n        :disabled=\"!selectedSeller || !fromCarton || !toCarton || loading\"\r\n      >\r\n        <span v-if=\"loading\" class=\"flex items-center justify-center\">\r\n          <svg class=\"animate-spin h-5 w-5 mr-2 text-white\" viewBox=\"0 0 24 24\">\r\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n          </svg>\r\n          Asignando...\r\n        </span>\r\n        <span v-else>Asignar Seleccionados</span>\r\n      </button>\r\n\r\n      <!-- Mensaje de Advertencia -->\r\n      <p v-if=\"!selectedSeller || !fromCarton || !toCarton\" class=\"text-yellow-600 text-sm text-center\">\r\n        Por favor, selecciona un vendedor y un rango de cartones.\r\n      </p>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { db } from '../firebase';\r\nimport { collection, query, where, getDocs, doc, updateDoc } from 'firebase/firestore';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      sellers: [],\r\n      availableCartons: [],\r\n      selectedSeller: '',\r\n      fromCarton: '',\r\n      toCarton: '',\r\n      loading: false\r\n    };\r\n  },\r\n  async mounted() {\r\n    await this.loadSellers();\r\n    await this.loadAvailableCartons();\r\n  },\r\n  methods: {\r\n    async loadSellers() {\r\n      try {\r\n        console.log('Cargando vendedores...');\r\n        const querySnapshot = await getDocs(collection(db, 'vendedores'));\r\n        this.sellers = querySnapshot.docs.map(docSnapshot => {\r\n          const data = docSnapshot.data();\r\n          return {\r\n            id: docSnapshot.id,\r\n            ...data,\r\n            vendedorId: data.vendedorId || docSnapshot.id\r\n          };\r\n        });\r\n        console.log('Vendedores cargados:', this.sellers);\r\n      } catch (error) {\r\n        console.error('Error al cargar los vendedores:', error);\r\n        this.$toast.error('Error al cargar los vendedores: ' + error.message);\r\n      }\r\n    },\r\n    async loadAvailableCartons() {\r\n      try {\r\n        console.log('Cargando cartones disponibles...');\r\n        const q = query(\r\n          collection(db, 'cartones'),\r\n          where('vendedorId', '==', null),\r\n          where('estado', '==', 'disponible')\r\n        );\r\n        const querySnapshot = await getDocs(q);\r\n        this.availableCartons = querySnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          serial: doc.data().serial\r\n        }));\r\n        // Ordenar los cartones por serial (LM seguido de números)\r\n        this.availableCartons.sort((a, b) => {\r\n          const serialA = parseInt(a.serial.replace('LM', ''), 10);\r\n          const serialB = parseInt(b.serial.replace('LM', ''), 10);\r\n          return serialA - serialB;\r\n        });\r\n        console.log('Cartones disponibles:', this.availableCartons);\r\n      } catch (error) {\r\n        console.error('Error al cargar cartones disponibles:', error);\r\n        this.$toast.error('Error al cargar cartones disponibles: ' + error.message);\r\n      }\r\n    },\r\n    async assignCartons() {\r\n      if (!this.selectedSeller || !this.fromCarton || !toCarton) return;\r\n\r\n      this.loading = true;\r\n      try {\r\n        console.log('Asignando cartones a vendedor:', this.selectedSeller, 'Desde:', this.fromCarton, 'Hasta:', this.toCarton);\r\n        const fromIndex = this.availableCartons.findIndex(carton => carton.id === this.fromCarton);\r\n        const toIndex = this.availableCartons.findIndex(carton => carton.id === this.toCarton);\r\n\r\n        if (fromIndex === -1 || toIndex === -1) {\r\n          throw new Error('Cartón inicial o final no encontrado');\r\n        }\r\n\r\n        const startIndex = Math.min(fromIndex, toIndex);\r\n        const endIndex = Math.max(fromIndex, toIndex);\r\n\r\n        const selectedCartons = this.availableCartons.slice(startIndex, endIndex + 1).map(carton => carton.id);\r\n        console.log('Cartones seleccionados en el rango:', selectedCartons);\r\n\r\n        const batch = [];\r\n        for (const cartonId of selectedCartons) {\r\n          const cartonRef = doc(db, 'cartones', cartonId);\r\n          batch.push(updateDoc(cartonRef, {\r\n            vendedorId: this.selectedSeller,\r\n            estado: 'asignado'\r\n          }));\r\n        }\r\n        await Promise.all(batch);\r\n        console.log('Cartones asignados exitosamente');\r\n        this.$toast.success('Cartones asignados exitosamente');\r\n\r\n        this.fromCarton = '';\r\n        this.toCarton = '';\r\n        await this.loadAvailableCartons();\r\n        this.$emit('cartones-asignados');\r\n      } catch (error) {\r\n        console.error('Error al asignar cartones:', error);\r\n        this.$toast.error('Error al asignar cartones: ' + (error.message || 'Error desconocido'));\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* Tailwind maneja los estilos */\r\n</style>\r\n```"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}