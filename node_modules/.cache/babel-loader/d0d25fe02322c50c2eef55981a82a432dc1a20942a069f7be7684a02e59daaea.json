{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport { auth, db } from '../firebase';\nimport LoginPage from '../components/LoginPage.vue';\nimport HomePage from '../views/HomePage.vue';\nimport SellerDashboard from '../components/SellerDashboard.vue';\nimport { doc, getDoc } from 'firebase/firestore';\nconst routes = [{\n  path: '/login',\n  name: 'LoginPage',\n  component: LoginPage\n}, {\n  path: '/',\n  name: 'HomePage',\n  component: HomePage,\n  meta: {\n    requiresAuth: true,\n    role: 'admin'\n  }\n}, {\n  path: '/vendedor',\n  name: 'SellerDashboard',\n  component: SellerDashboard,\n  meta: {\n    requiresAuth: true,\n    role: 'seller'\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\nrouter.beforeEach(async (to, from, next) => {\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n  const requiredRole = to.meta.role;\n  const user = auth.currentUser;\n  if (!user && requiresAuth) {\n    return next('/login');\n  }\n  if (user) {\n    if (to.path === '/login') {\n      const isAdmin = user.email === 'master1@example.com';\n      const sellerDoc = await getDoc(doc(db, 'vendedores', user.uid));\n      const isSeller = sellerDoc.exists();\n      if (isAdmin) {\n        return next('/');\n      } else if (isSeller) {\n        return next('/vendedor');\n      } else {\n        await auth.signOut();\n        return next('/login');\n      }\n    }\n    if (requiresAuth && requiredRole) {\n      const isAdmin = user.email === 'master1@example.com';\n      const sellerDoc = await getDoc(doc(db, 'vendedores', user.uid));\n      const isSeller = sellerDoc.exists();\n      if (requiredRole === 'admin' && isAdmin) {\n        return next();\n      } else if (requiredRole === 'seller' && isSeller) {\n        return next();\n      } else {\n        await auth.signOut();\n        if (isAdmin) {\n          return next('/');\n        } else if (isSeller) {\n          return next('/vendedor');\n        } else {\n          return next('/login');\n        }\n      }\n    }\n  }\n  return next();\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","auth","db","LoginPage","HomePage","SellerDashboard","doc","getDoc","routes","path","name","component","meta","requiresAuth","role","router","history","beforeEach","to","from","next","matched","some","record","requiredRole","user","currentUser","isAdmin","email","sellerDoc","uid","isSeller","exists","signOut"],"sources":["D:/Lotweb/venta-cartones/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router';\r\nimport { auth, db } from '../firebase';\r\nimport LoginPage from '../components/LoginPage.vue';\r\nimport HomePage from '../views/HomePage.vue';\r\nimport SellerDashboard from '../components/SellerDashboard.vue';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\n\r\nconst routes = [\r\n  {\r\n    path: '/login',\r\n    name: 'LoginPage',\r\n    component: LoginPage\r\n  },\r\n  {\r\n    path: '/',\r\n    name: 'HomePage',\r\n    component: HomePage,\r\n    meta: { requiresAuth: true, role: 'admin' }\r\n  },\r\n  {\r\n    path: '/vendedor',\r\n    name: 'SellerDashboard',\r\n    component: SellerDashboard,\r\n    meta: { requiresAuth: true, role: 'seller' }\r\n  }\r\n];\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(),\r\n  routes\r\n});\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\r\n  const requiredRole = to.meta.role;\r\n\r\n  const user = auth.currentUser;\r\n  if (!user && requiresAuth) {\r\n    return next('/login');\r\n  }\r\n\r\n  if (user) {\r\n    if (to.path === '/login') {\r\n      const isAdmin = user.email === 'master1@example.com';\r\n      const sellerDoc = await getDoc(doc(db, 'vendedores', user.uid));\r\n      const isSeller = sellerDoc.exists();\r\n\r\n      if (isAdmin) {\r\n        return next('/');\r\n      } else if (isSeller) {\r\n        return next('/vendedor');\r\n      } else {\r\n        await auth.signOut();\r\n        return next('/login');\r\n      }\r\n    }\r\n\r\n    if (requiresAuth && requiredRole) {\r\n      const isAdmin = user.email === 'master1@example.com';\r\n      const sellerDoc = await getDoc(doc(db, 'vendedores', user.uid));\r\n      const isSeller = sellerDoc.exists();\r\n\r\n      if (requiredRole === 'admin' && isAdmin) {\r\n        return next();\r\n      } else if (requiredRole === 'seller' && isSeller) {\r\n        return next();\r\n      } else {\r\n        await auth.signOut();\r\n        if (isAdmin) {\r\n          return next('/');\r\n        } else if (isSeller) {\r\n          return next('/vendedor');\r\n        } else {\r\n          return next('/login');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return next();\r\n});\r\n\r\nexport default router;"],"mappings":";;AAAA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,SAASC,IAAI,EAAEC,EAAE,QAAQ,aAAa;AACtC,OAAOC,SAAS,MAAM,6BAA6B;AACnD,OAAOC,QAAQ,MAAM,uBAAuB;AAC5C,OAAOC,eAAe,MAAM,mCAAmC;AAC/D,SAASC,GAAG,EAAEC,MAAM,QAAQ,oBAAoB;AAEhD,MAAMC,MAAM,GAAG,CACb;EACEC,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE,WAAW;EACjBC,SAAS,EAAER;AACb,CAAC,EACD;EACEM,IAAI,EAAE,GAAG;EACTC,IAAI,EAAE,UAAU;EAChBC,SAAS,EAAEP,QAAQ;EACnBQ,IAAI,EAAE;IAAEC,YAAY,EAAE,IAAI;IAAEC,IAAI,EAAE;EAAQ;AAC5C,CAAC,EACD;EACEL,IAAI,EAAE,WAAW;EACjBC,IAAI,EAAE,iBAAiB;EACvBC,SAAS,EAAEN,eAAe;EAC1BO,IAAI,EAAE;IAAEC,YAAY,EAAE,IAAI;IAAEC,IAAI,EAAE;EAAS;AAC7C,CAAC,CACF;AAED,MAAMC,MAAM,GAAGhB,YAAY,CAAC;EAC1BiB,OAAO,EAAEhB,gBAAgB,CAAC,CAAC;EAC3BQ;AACF,CAAC,CAAC;AAEFO,MAAM,CAACE,UAAU,CAAC,OAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAC1C,MAAMP,YAAY,GAAGK,EAAE,CAACG,OAAO,CAACC,IAAI,CAACC,MAAM,IAAIA,MAAM,CAACX,IAAI,CAACC,YAAY,CAAC;EACxE,MAAMW,YAAY,GAAGN,EAAE,CAACN,IAAI,CAACE,IAAI;EAEjC,MAAMW,IAAI,GAAGxB,IAAI,CAACyB,WAAW;EAC7B,IAAI,CAACD,IAAI,IAAIZ,YAAY,EAAE;IACzB,OAAOO,IAAI,CAAC,QAAQ,CAAC;EACvB;EAEA,IAAIK,IAAI,EAAE;IACR,IAAIP,EAAE,CAACT,IAAI,KAAK,QAAQ,EAAE;MACxB,MAAMkB,OAAO,GAAGF,IAAI,CAACG,KAAK,KAAK,qBAAqB;MACpD,MAAMC,SAAS,GAAG,MAAMtB,MAAM,CAACD,GAAG,CAACJ,EAAE,EAAE,YAAY,EAAEuB,IAAI,CAACK,GAAG,CAAC,CAAC;MAC/D,MAAMC,QAAQ,GAAGF,SAAS,CAACG,MAAM,CAAC,CAAC;MAEnC,IAAIL,OAAO,EAAE;QACX,OAAOP,IAAI,CAAC,GAAG,CAAC;MAClB,CAAC,MAAM,IAAIW,QAAQ,EAAE;QACnB,OAAOX,IAAI,CAAC,WAAW,CAAC;MAC1B,CAAC,MAAM;QACL,MAAMnB,IAAI,CAACgC,OAAO,CAAC,CAAC;QACpB,OAAOb,IAAI,CAAC,QAAQ,CAAC;MACvB;IACF;IAEA,IAAIP,YAAY,IAAIW,YAAY,EAAE;MAChC,MAAMG,OAAO,GAAGF,IAAI,CAACG,KAAK,KAAK,qBAAqB;MACpD,MAAMC,SAAS,GAAG,MAAMtB,MAAM,CAACD,GAAG,CAACJ,EAAE,EAAE,YAAY,EAAEuB,IAAI,CAACK,GAAG,CAAC,CAAC;MAC/D,MAAMC,QAAQ,GAAGF,SAAS,CAACG,MAAM,CAAC,CAAC;MAEnC,IAAIR,YAAY,KAAK,OAAO,IAAIG,OAAO,EAAE;QACvC,OAAOP,IAAI,CAAC,CAAC;MACf,CAAC,MAAM,IAAII,YAAY,KAAK,QAAQ,IAAIO,QAAQ,EAAE;QAChD,OAAOX,IAAI,CAAC,CAAC;MACf,CAAC,MAAM;QACL,MAAMnB,IAAI,CAACgC,OAAO,CAAC,CAAC;QACpB,IAAIN,OAAO,EAAE;UACX,OAAOP,IAAI,CAAC,GAAG,CAAC;QAClB,CAAC,MAAM,IAAIW,QAAQ,EAAE;UACnB,OAAOX,IAAI,CAAC,WAAW,CAAC;QAC1B,CAAC,MAAM;UACL,OAAOA,IAAI,CAAC,QAAQ,CAAC;QACvB;MACF;IACF;EACF;EAEA,OAAOA,IAAI,CAAC,CAAC;AACf,CAAC,CAAC;AAEF,eAAeL,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}