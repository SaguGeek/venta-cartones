{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { db } from '../firebase';\nimport { collection, query, where, getDocs, doc, getDoc, updateDoc } from 'firebase/firestore';\nexport default {\n  data() {\n    return {\n      sellers: [],\n      availableCartons: [],\n      selectedVendedorId: '',\n      selectedCartons: [],\n      errorMessage: '',\n      successMessage: ''\n    };\n  },\n  async mounted() {\n    console.log('Componente AssignCartons montado');\n    await this.loadSellers();\n    await this.loadAvailableCartons();\n  },\n  methods: {\n    logSelection() {\n      console.log('Selección actualizada:', {\n        selectedVendedorId: this.selectedVendedorId,\n        selectedCartons: this.selectedCartons\n      });\n    },\n    async loadSellers() {\n      try {\n        console.log('Iniciando carga de vendedores...');\n        const querySnapshot = await getDocs(collection(db, 'vendedores'));\n        this.sellers = querySnapshot.docs.map(doc => doc.data());\n        console.log('Vendedores cargados:', this.sellers);\n      } catch (error) {\n        console.error('Error al cargar los vendedores:', error);\n        this.errorMessage = 'Error al cargar los vendedores: ' + error.message;\n      }\n    },\n    async loadAvailableCartons() {\n      try {\n        console.log('Cargando cartones disponibles...');\n        const q = query(collection(db, 'cartones'), where('estado', '==', 'disponible'), where('vendedorId', '==', null));\n        const querySnapshot = await getDocs(q);\n        this.availableCartons = querySnapshot.docs.map(doc => ({\n          id: doc.id,\n          serial: doc.data().serial\n        })).sort((a, b) => a.serial.localeCompare(b.serial));\n        console.log('Cartones disponibles cargados (ordenados):', this.availableCartons);\n      } catch (error) {\n        console.error('Error al cargar los cartones disponibles:', error);\n        this.errorMessage = 'Error al cargar los cartones disponibles: ' + error.message;\n      }\n    },\n    async assignSelectedCartons() {\n      console.log('Botón \"Asignar Seleccionados\" clicado');\n      console.log('Valores seleccionados:', {\n        selectedVendedorId: this.selectedVendedorId,\n        selectedCartons: this.selectedCartons\n      });\n      this.errorMessage = '';\n      this.successMessage = '';\n      if (!this.selectedVendedorId || this.selectedCartons.length === 0) {\n        console.log('Campos incompletos o sin cartones seleccionados');\n        this.errorMessage = 'Por favor, selecciona un vendedor y al menos un cartón.';\n        return;\n      }\n      try {\n        console.log('Iniciando proceso de asignación...');\n        const cartonesToAssign = this.availableCartons.filter(carton => this.selectedCartons.includes(carton.id));\n        console.log('Cartones a asignar:', cartonesToAssign);\n        if (cartonesToAssign.length === 0) {\n          console.log('No hay cartones seleccionados para asignar');\n          this.errorMessage = 'No hay cartones seleccionados para asignar.';\n          return;\n        }\n\n        // Verificar si algún cartón ya está asignado\n        let alreadyAssignedSerials = [];\n        for (const carton of cartonesToAssign) {\n          console.log(`Verificando cartón ${carton.serial}...`);\n          const cartonRef = doc(db, 'cartones', carton.id);\n          const cartonDoc = await getDoc(cartonRef);\n          if (cartonDoc.exists() && cartonDoc.data().vendedorId && cartonDoc.data().vendedorId !== this.selectedVendedorId) {\n            alreadyAssignedSerials.push(carton.serial);\n          }\n        }\n        if (alreadyAssignedSerials.length > 0) {\n          console.log('Cartones ya asignados detectados:', alreadyAssignedSerials);\n          this.errorMessage = `Los siguientes cartones ya están asignados a otro vendedor: ${alreadyAssignedSerials.join(', ')}`;\n          return;\n        }\n\n        // Asignar los cartones\n        console.log('Procediendo a asignar cartones...');\n        for (const carton of cartonesToAssign) {\n          console.log(`Asignando cartón ${carton.serial} a ${this.selectedVendedorId}`);\n          await updateDoc(doc(db, 'cartones', carton.id), {\n            vendedorId: this.selectedVendedorId\n          });\n          console.log(`Cartón ${carton.serial} asignado exitosamente`);\n        }\n        console.log('Asignación completada para', cartonesToAssign.length, 'cartones');\n        this.successMessage = 'Cartones asignados';\n        this.selectedCartons = [];\n        this.selectedVendedorId = '';\n        // Recargar los cartones disponibles\n        await this.loadAvailableCartons();\n      } catch (error) {\n        console.error('Error al asignar cartones:', error);\n        this.errorMessage = 'Error al asignar cartones: ' + error.message;\n      }\n    }\n  }\n};","map":{"version":3,"names":["db","collection","query","where","getDocs","doc","getDoc","updateDoc","data","sellers","availableCartons","selectedVendedorId","selectedCartons","errorMessage","successMessage","mounted","console","log","loadSellers","loadAvailableCartons","methods","logSelection","querySnapshot","docs","map","error","message","q","id","serial","sort","a","b","localeCompare","assignSelectedCartons","length","cartonesToAssign","filter","carton","includes","alreadyAssignedSerials","cartonRef","cartonDoc","exists","vendedorId","push","join"],"sources":["D:\\Lotweb\\venta-cartones\\src\\components\\AssignCartons.vue"],"sourcesContent":["```vue\r\n   <template>\r\n     <div class=\"bg-white p-6 rounded-lg shadow-md mb-6\">\r\n       <h2 class=\"text-2xl font-semibold text-gray-800 mb-4\">Asignar Cartones por Lote</h2>\r\n       <div class=\"space-y-4\">\r\n         <div>\r\n           <label class=\"block text-gray-600 mb-1\">Seleccionar Vendedor</label>\r\n           <select\r\n             v-model=\"selectedVendedorId\"\r\n             @change=\"logSelection\"\r\n             class=\"w-full p-2 border rounded-md\"\r\n           >\r\n             <option value=\"\" disabled>Selecciona un vendedor</option>\r\n             <option v-for=\"seller in sellers\" :key=\"seller.vendedorId\" :value=\"seller.vendedorId\">\r\n               {{ seller.nombre || seller.vendedorId }}\r\n             </option>\r\n           </select>\r\n         </div>\r\n         <div>\r\n           <label class=\"block text-gray-600 mb-1\">Seleccionar Cartones</label>\r\n           <div v-if=\"availableCartons.length > 0\" class=\"space-y-2 max-h-60 overflow-y-auto border rounded-md p-2\">\r\n             <label v-for=\"carton in availableCartons\" :key=\"carton.id\" class=\"flex items-center space-x-2\">\r\n               <input type=\"checkbox\" v-model=\"selectedCartons\" :value=\"carton.id\">\r\n               <span>{{ carton.serial }}</span>\r\n             </label>\r\n           </div>\r\n           <p v-else class=\"text-gray-500\">No hay cartones disponibles.</p>\r\n         </div>\r\n         <button\r\n           @click=\"assignSelectedCartons\"\r\n           class=\"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition\"\r\n           :disabled=\"!selectedVendedorId || selectedCartons.length === 0\"\r\n         >\r\n           Asignar Seleccionados\r\n         </button>\r\n         <p v-if=\"!selectedVendedorId || selectedCartons.length === 0\" class=\"text-yellow-600 mt-2\">Por favor, selecciona un vendedor y al menos un cartón.</p>\r\n       </div>\r\n       <p v-if=\"errorMessage\" class=\"text-red-600 mt-2\">{{ errorMessage }}</p>\r\n       <p v-if=\"successMessage\" class=\"text-green-600 mt-2\">{{ successMessage }}</p>\r\n     </div>\r\n   </template>\r\n\r\n   <script>\r\n   import { db } from '../firebase';\r\n   import { collection, query, where, getDocs, doc, getDoc, updateDoc } from 'firebase/firestore';\r\n\r\n   export default {\r\n     data() {\r\n       return {\r\n         sellers: [],\r\n         availableCartons: [],\r\n         selectedVendedorId: '',\r\n         selectedCartons: [],\r\n         errorMessage: '',\r\n         successMessage: ''\r\n       };\r\n     },\r\n     async mounted() {\r\n       console.log('Componente AssignCartons montado');\r\n       await this.loadSellers();\r\n       await this.loadAvailableCartons();\r\n     },\r\n     methods: {\r\n       logSelection() {\r\n         console.log('Selección actualizada:', {\r\n           selectedVendedorId: this.selectedVendedorId,\r\n           selectedCartons: this.selectedCartons\r\n         });\r\n       },\r\n       async loadSellers() {\r\n         try {\r\n           console.log('Iniciando carga de vendedores...');\r\n           const querySnapshot = await getDocs(collection(db, 'vendedores'));\r\n           this.sellers = querySnapshot.docs.map(doc => doc.data());\r\n           console.log('Vendedores cargados:', this.sellers);\r\n         } catch (error) {\r\n           console.error('Error al cargar los vendedores:', error);\r\n           this.errorMessage = 'Error al cargar los vendedores: ' + error.message;\r\n         }\r\n       },\r\n       async loadAvailableCartons() {\r\n         try {\r\n           console.log('Cargando cartones disponibles...');\r\n           const q = query(\r\n             collection(db, 'cartones'),\r\n             where('estado', '==', 'disponible'),\r\n             where('vendedorId', '==', null)\r\n           );\r\n           const querySnapshot = await getDocs(q);\r\n           this.availableCartons = querySnapshot.docs.map(doc => ({\r\n             id: doc.id,\r\n             serial: doc.data().serial\r\n           })).sort((a, b) => a.serial.localeCompare(b.serial));\r\n           console.log('Cartones disponibles cargados (ordenados):', this.availableCartons);\r\n         } catch (error) {\r\n           console.error('Error al cargar los cartones disponibles:', error);\r\n           this.errorMessage = 'Error al cargar los cartones disponibles: ' + error.message;\r\n         }\r\n       },\r\n       async assignSelectedCartons() {\r\n         console.log('Botón \"Asignar Seleccionados\" clicado');\r\n         console.log('Valores seleccionados:', {\r\n           selectedVendedorId: this.selectedVendedorId,\r\n           selectedCartons: this.selectedCartons\r\n         });\r\n\r\n         this.errorMessage = '';\r\n         this.successMessage = '';\r\n\r\n         if (!this.selectedVendedorId || this.selectedCartons.length === 0) {\r\n           console.log('Campos incompletos o sin cartones seleccionados');\r\n           this.errorMessage = 'Por favor, selecciona un vendedor y al menos un cartón.';\r\n           return;\r\n         }\r\n\r\n         try {\r\n           console.log('Iniciando proceso de asignación...');\r\n           const cartonesToAssign = this.availableCartons.filter(carton => this.selectedCartons.includes(carton.id));\r\n           console.log('Cartones a asignar:', cartonesToAssign);\r\n\r\n           if (cartonesToAssign.length === 0) {\r\n             console.log('No hay cartones seleccionados para asignar');\r\n             this.errorMessage = 'No hay cartones seleccionados para asignar.';\r\n             return;\r\n           }\r\n\r\n           // Verificar si algún cartón ya está asignado\r\n           let alreadyAssignedSerials = [];\r\n           for (const carton of cartonesToAssign) {\r\n             console.log(`Verificando cartón ${carton.serial}...`);\r\n             const cartonRef = doc(db, 'cartones', carton.id);\r\n             const cartonDoc = await getDoc(cartonRef);\r\n             if (cartonDoc.exists() && cartonDoc.data().vendedorId && cartonDoc.data().vendedorId !== this.selectedVendedorId) {\r\n               alreadyAssignedSerials.push(carton.serial);\r\n             }\r\n           }\r\n\r\n           if (alreadyAssignedSerials.length > 0) {\r\n             console.log('Cartones ya asignados detectados:', alreadyAssignedSerials);\r\n             this.errorMessage = `Los siguientes cartones ya están asignados a otro vendedor: ${alreadyAssignedSerials.join(', ')}`;\r\n             return;\r\n           }\r\n\r\n           // Asignar los cartones\r\n           console.log('Procediendo a asignar cartones...');\r\n           for (const carton of cartonesToAssign) {\r\n             console.log(`Asignando cartón ${carton.serial} a ${this.selectedVendedorId}`);\r\n             await updateDoc(doc(db, 'cartones', carton.id), {\r\n               vendedorId: this.selectedVendedorId\r\n             });\r\n             console.log(`Cartón ${carton.serial} asignado exitosamente`);\r\n           }\r\n\r\n           console.log('Asignación completada para', cartonesToAssign.length, 'cartones');\r\n           this.successMessage = 'Cartones asignados';\r\n           this.selectedCartons = [];\r\n           this.selectedVendedorId = '';\r\n           // Recargar los cartones disponibles\r\n           await this.loadAvailableCartons();\r\n         } catch (error) {\r\n           console.error('Error al asignar cartones:', error);\r\n           this.errorMessage = 'Error al asignar cartones: ' + error.message;\r\n         }\r\n       }\r\n     }\r\n   };\r\n   </script>\r\n\r\n   <style scoped>\r\n   /* Tailwind maneja los estilos */\r\n   </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}