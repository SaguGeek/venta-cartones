(function(){"use strict";var e={8743:function(e,t,a){var r=a(5130),s=a(6768);const o={id:"app",class:"min-h-screen bg-gray-100"};function n(e,t,a,r,n,l){const i=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(i)])}var l={name:"App"},i=a(1241);const d=(0,i.A)(l,[["render",n],["__scopeId","data-v-1a736ddc"]]);var c=d,u=(a(8111),a(3579),a(1387)),g=a(6400),h=a(7617),m=a(4642);const p={apiKey:"AIzaSyDuDgUKBvCS2ydM1qL4-aKd3c6h_SeXu2I",authDomain:"miproyecto-a1543.firebaseapp.com",projectId:"miproyecto-a1543",storageBucket:"miproyecto-a1543.firebasestorage.app",messagingSenderId:"290353843094",appId:"1:290353843094:web:0d5c6c81778533e0eb6bb7",measurementId:"G-DRR74Q8GQN"},b=(0,g.Wp)(p),v=(0,h.aU)(b),f=(0,m.xI)(b);var y=a(4232);const x={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 to-purple-300"},C={class:"bg-white p-8 rounded-xl shadow-2xl w-full max-w-md transform transition-all duration-500 opacity-0 animate-fade-in"},k=["disabled"],w={key:0,class:"flex items-center"},L={key:1},E={key:0,class:"text-red-500 text-sm text-center"};function S(e,t,a,o,n,l){return(0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("div",C,[t[6]||(t[6]=(0,s.Fv)('<div class="text-center mb-6" data-v-d1cb4e26><div class="flex justify-center mb-4" data-v-d1cb4e26><span class="text-4xl font-bold text-indigo-600 animate-spin-slow" data-v-d1cb4e26>VC</span></div><h2 class="text-3xl font-bold text-gray-800 mb-2" data-v-d1cb4e26>Venta de Cartones</h2><p class="text-gray-600" data-v-d1cb4e26>Inicia sesión para gestionar tus cartones</p></div>',1)),(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,r.D$)(((...e)=>l.login&&l.login(...e)),["prevent"])),class:"space-y-6"},[(0,s.Lk)("div",null,[t[3]||(t[3]=(0,s.Lk)("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Correo Electrónico",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),type:"email",id:"email",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300",placeholder:"master1@example.com",required:""},null,512),[[r.Jo,n.email]])]),(0,s.Lk)("div",null,[t[4]||(t[4]=(0,s.Lk)("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Contraseña",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),type:"password",id:"password",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300",placeholder:"Sagu7.98",required:""},null,512),[[r.Jo,n.password]])]),(0,s.Lk)("button",{type:"submit",disabled:n.loading,class:"w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300 flex items-center justify-center"},[n.loading?((0,s.uX)(),(0,s.CE)("span",w,t[5]||(t[5]=[(0,s.Lk)("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",viewBox:"0 0 24 24"},[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),(0,s.eW)(" Cargando... ")]))):((0,s.uX)(),(0,s.CE)("span",L,"Iniciar Sesión"))],8,k),n.error?((0,s.uX)(),(0,s.CE)("p",E,(0,y.v_)(n.error),1)):(0,s.Q3)("",!0)],32),t[7]||(t[7]=(0,s.Lk)("div",{class:"mt-4 text-center"},[(0,s.Lk)("p",{class:"text-gray-600 text-sm"},[(0,s.eW)("¿Olvidaste tu contraseña? "),(0,s.Lk)("a",{href:"#",class:"text-indigo-600 hover:underline transition duration-300"},"Recupérala")])],-1))])])}a(4114);var P={name:"LoginPage",data(){return{email:"",password:"",error:"",loading:!1}},methods:{async login(){this.loading=!0,this.error="";try{console.log("Intentando iniciar sesión con:",this.email,this.password);const e=await(0,m.x9)(f,this.email,this.password);console.log("Sesión iniciada con éxito:",e.user);const t=e.user,a="master1@example.com"===t.email,r=await(0,h.x7)((0,h.H9)(v,"vendedores",t.uid)),s=r.exists();if(a)this.$router.push("/");else{if(!s)throw new Error("Este usuario no tiene permisos para acceder.");this.$router.push("/vendedor")}}catch(e){console.error("Error al iniciar sesión:",e.code,e.message),this.error=`Error: ${e.message}`,f.currentUser&&await f.signOut()}finally{this.loading=!1}},async resetPassword(){if(this.email)try{await(0,m.J1)(f,this.email),this.error="Se ha enviado un correo para restablecer tu contraseña."}catch(e){console.error("Error al enviar correo de recuperación:",e),this.error="Error al enviar el correo de recuperación."}else this.error="Por favor ingresa tu correo electrónico para recuperar la contraseña."}}};const I=(0,i.A)(P,[["render",S],["__scopeId","data-v-d1cb4e26"]]);var _=I;const A={class:"min-h-screen bg-gradient-to-br from-gray-900 via-indigo-900 to-purple-900"},M={class:"bg-gray-800 bg-opacity-90 shadow-xl sticky top-0 z-50 backdrop-blur-md"},U={class:"container mx-auto px-6 py-4 flex justify-between items-center"},X={class:"container mx-auto px-6 py-10"},T={class:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8"},$={class:"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2"},D={class:"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2"},V={class:"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2"},j={class:"bg-white bg-opacity-90 backdrop-blur-lg p-8 rounded-2xl shadow-2xl transition-all duration-500 hover:shadow-3xl hover:-translate-y-2"};function F(e,t,a,r,o,n){const l=(0,s.g2)("UploadCarton"),i=(0,s.g2)("AssignCartons"),d=(0,s.g2)("CartonList"),c=(0,s.g2)("SellerList");return(0,s.uX)(),(0,s.CE)("div",A,[(0,s.Lk)("header",M,[(0,s.Lk)("div",U,[t[1]||(t[1]=(0,s.Lk)("div",{class:"flex items-center space-x-4"},[(0,s.Lk)("span",{class:"text-3xl font-extrabold text-purple-400 animate-pulse"},"VC"),(0,s.Lk)("h1",{class:"text-2xl font-bold text-white tracking-wide"},"Dashboard Admin")],-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.logout&&n.logout(...e)),class:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-5 py-2 rounded-full hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-purple-400 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105"}," Cerrar Sesión ")])]),(0,s.Lk)("main",X,[(0,s.Lk)("div",T,[(0,s.Lk)("div",$,[t[2]||(t[2]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-6 tracking-tight"},"Subir Cartones",-1)),(0,s.bF)(l,{onCheckDuplicates:n.checkDuplicates,onImagesUploaded:n.handleImagesUploaded},null,8,["onCheckDuplicates","onImagesUploaded"])]),(0,s.Lk)("div",D,[t[3]||(t[3]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-6 tracking-tight"},"Asignar Cartones",-1)),(0,s.bF)(i,{onCartonesAsignados:n.refreshCartones},null,8,["onCartonesAsignados"])]),(0,s.Lk)("div",V,[t[4]||(t[4]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-6 tracking-tight"},"Lista de Cartones",-1)),(0,s.bF)(d,{ref:"cartonList"},null,512)]),(0,s.Lk)("div",j,[t[5]||(t[5]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-6 tracking-tight"},"Lista de Vendedores",-1)),(0,s.bF)(c)])])])])}a(2489),a(116),a(1701);const O={class:"bg-white p-6 rounded-lg shadow-md mb-6"},Q={class:"flex flex-col items-center"},G=["disabled"],H={key:0,class:"flex items-center"},J={key:1},R={key:0,class:"mt-4"},N={class:"mt-2"},z={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},W={class:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full"},B={class:"w-full bg-gray-200 rounded-full h-4 mb-2"},q={class:"text-center text-gray-700"},K=["disabled"];function Z(e,t,a,r,o,n){return(0,s.uX)(),(0,s.CE)("div",O,[t[6]||(t[6]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Subir Cartones",-1)),(0,s.Lk)("div",Q,[(0,s.Lk)("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>n.onFileChange&&n.onFileChange(...e)),accept:"image/*",multiple:"",class:"mb-4 p-2 border rounded-md w-full max-w-md"},null,32),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.checkAndUploadImages&&n.checkAndUploadImages(...e)),class:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition flex items-center justify-center",disabled:o.uploading||!o.selectedFiles.length},[o.uploading?((0,s.uX)(),(0,s.CE)("span",H,t[3]||(t[3]=[(0,s.Lk)("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",viewBox:"0 0 24 24"},[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),(0,s.eW)(" Subiendo... ")]))):((0,s.uX)(),(0,s.CE)("span",J,"Subir Imágenes"))],8,G)]),o.duplicates.length>0?((0,s.uX)(),(0,s.CE)("div",R,[t[4]||(t[4]=(0,s.Lk)("h3",{class:"text-lg font-medium text-red-600"},"Archivos ya existentes:",-1)),(0,s.Lk)("ul",N,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.duplicates,(e=>((0,s.uX)(),(0,s.CE)("li",{key:e,class:"text-red-600"},(0,y.v_)(e),1)))),128))])])):(0,s.Q3)("",!0),o.showProgressModal?((0,s.uX)(),(0,s.CE)("div",z,[(0,s.Lk)("div",W,[t[5]||(t[5]=(0,s.Lk)("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"Subiendo Imágenes",-1)),(0,s.Lk)("div",B,[(0,s.Lk)("div",{class:"bg-blue-600 h-4 rounded-full transition-all duration-300",style:(0,y.Tr)({width:o.progress+"%"})},null,4)]),(0,s.Lk)("p",q,(0,y.v_)(o.uploadedCount)+" de "+(0,y.v_)(o.totalFiles)+" subidas",1),(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.closeProgressModal&&n.closeProgressModal(...e)),class:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition",disabled:o.uploading}," Cerrar ",8,K)])])):(0,s.Q3)("",!0)])}var Y={data(){return{selectedFiles:[],uploadedUrls:[],duplicates:[],uploadErrors:[],uploading:!1,uploadedCount:0,totalFiles:0,progress:0,showProgressModal:!1,cloudinaryUrl:"https://api.cloudinary.com/v1_1/dardyvsja/image/upload",uploadPreset:"cartones_upload"}},methods:{onFileChange(e){this.selectedFiles=Array.from(e.target.files),this.uploadedUrls=[],this.duplicates=[],this.uploadErrors=[],this.showProgressModal=!1},async checkAndUploadImages(){if(0===this.selectedFiles.length)return void alert("Por favor, selecciona al menos una imagen.");this.uploading=!0,this.totalFiles=this.selectedFiles.length,this.uploadedCount=0,this.progress=0,this.showProgressModal=!0;const e=this.selectedFiles.map((e=>e.name.split(".")[0])),t=this;this.$emit("check-duplicates",{serials:e,files:this.selectedFiles},(async e=>{try{if(!Array.isArray(e))throw new Error("La respuesta de duplicados no es válida.");if(0===e.length)return alert("Todos los archivos seleccionados ya existen."),t.uploading=!1,void(t.showProgressModal=!1);t.duplicates=t.selectedFiles.filter((t=>!e.some((e=>e.name===t.name)))).map((e=>e.name));const a=e.map((async e=>{const a=e.name.split(".")[0],r=new FormData;r.append("file",e),r.append("upload_preset",t.uploadPreset);try{const s=await fetch(t.cloudinaryUrl,{method:"POST",body:r}),o=await s.json();if(o.secure_url)return t.uploadedUrls.push(o.secure_url),t.uploadedCount++,t.progress=Math.round(t.uploadedCount/t.totalFiles*100),{serial:a,imageUrl:o.secure_url};throw new Error(`Error al subir ${e.name}: ${JSON.stringify(o)}`)}catch(s){return console.error(`Error al subir ${e.name}:`,s),null}})),r=await Promise.all(a),s=r.filter((e=>null!==e));s.length>0?(t.$emit("images-uploaded",s),alert(`${s.length} de ${e.length} imágenes subidas correctamente.`)):alert("No se subieron imágenes correctamente.")}catch(a){console.error("Error en el proceso de subida:",a),alert("Error en el proceso de subida: "+a.message)}finally{t.uploading=!1,t.progress=100,setTimeout((()=>{t.showProgressModal=!1}),1e3)}}))},closeProgressModal(){this.uploading||(this.showProgressModal=!1)}}};const ee=(0,i.A)(Y,[["render",Z],["__scopeId","data-v-47da28a0"]]);var te=ee;const ae={class:"space-y-4"},re=["value"],se={class:"flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0"},oe={class:"w-full sm:w-1/2"},ne=["value"],le={class:"w-full sm:w-1/2"},ie=["value"],de=["disabled"],ce={key:0,class:"text-yellow-600 text-sm text-center"};function ue(e,t,a,o,n,l){return(0,s.uX)(),(0,s.CE)("div",ae,[t[10]||(t[10]=(0,s.Lk)("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Asignar Cartones por Lote",-1)),(0,s.Lk)("form",{onSubmit:t[3]||(t[3]=(0,r.D$)(((...e)=>l.assignCartons&&l.assignCartons(...e)),["prevent"])),class:"space-y-4"},[(0,s.Lk)("div",null,[t[5]||(t[5]=(0,s.Lk)("label",{for:"seller",class:"block text-sm font-medium text-gray-700"},"Seleccionar Vendedor",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedSeller=e),id:"seller",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300"},[t[4]||(t[4]=(0,s.Lk)("option",{value:"",disabled:""},"Selecciona un vendedor",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.sellers,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.nombre||e.id),9,re)))),128))],512),[[r.u1,n.selectedSeller]])]),(0,s.Lk)("div",se,[(0,s.Lk)("div",oe,[t[7]||(t[7]=(0,s.Lk)("label",{for:"fromCarton",class:"block text-sm font-medium text-gray-700"},"Desde",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.fromCarton=e),id:"fromCarton",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300"},[t[6]||(t[6]=(0,s.Lk)("option",{value:"",disabled:""},"Selecciona un cartón",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.availableCartons,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.serial),9,ne)))),128))],512),[[r.u1,n.fromCarton]])]),(0,s.Lk)("div",le,[t[9]||(t[9]=(0,s.Lk)("label",{for:"toCarton",class:"block text-sm font-medium text-gray-700"},"Hasta",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.toCarton=e),id:"toCarton",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300"},[t[8]||(t[8]=(0,s.Lk)("option",{value:"",disabled:""},"Selecciona un cartón",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.availableCartons,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.serial),9,ie)))),128))],512),[[r.u1,n.toCarton]])])]),(0,s.Lk)("button",{type:"submit",class:"w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300",disabled:!n.selectedSeller||!n.fromCarton||!n.toCarton}," Asignar Seleccionados ",8,de),n.selectedSeller&&n.fromCarton&&n.toCarton?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("p",ce," Por favor, selecciona un vendedor y un rango de cartones. "))],32)])}var ge={data(){return{sellers:[],availableCartons:[],selectedSeller:"",fromCarton:"",toCarton:""}},async mounted(){await this.loadSellers(),await this.loadAvailableCartons()},methods:{async loadSellers(){try{console.log("Cargando vendedores...");const e=await(0,h.GG)((0,h.rJ)(v,"vendedores"));this.sellers=e.docs.map((e=>{const t=e.data();return{id:e.id,...t,vendedorId:t.vendedorId||e.id}})),console.log("Vendedores cargados:",this.sellers)}catch(e){console.error("Error al cargar los vendedores:",e),alert("Error al cargar los vendedores: "+e.message)}},async loadAvailableCartons(){try{console.log("Cargando cartones disponibles...");const e=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",null),(0,h._M)("estado","==","disponible")),t=await(0,h.GG)(e);this.availableCartons=t.docs.map((e=>({id:e.id,serial:e.data().serial}))),this.availableCartons.sort(((e,t)=>e.serial.localeCompare(t.serial))),console.log("Cartones disponibles:",this.availableCartons)}catch(e){console.error("Error al cargar cartones disponibles:",e),alert("Error al cargar cartones disponibles: "+e.message)}},async assignCartons(){if(this.selectedSeller&&this.fromCarton&&this.toCarton)try{console.log("Asignando cartones a vendedor:",this.selectedSeller,"Desde:",this.fromCarton,"Hasta:",this.toCarton);const e=this.availableCartons.findIndex((e=>e.id===this.fromCarton)),t=this.availableCartons.findIndex((e=>e.id===this.toCarton));if(-1===e||-1===t)throw new Error("Cartón inicial o final no encontrado");const a=Math.min(e,t),r=Math.max(e,t),s=this.availableCartons.slice(a,r+1).map((e=>e.id));console.log("Cartones seleccionados en el rango:",s);const o=[];for(const n of s){const e=(0,h.H9)(v,"cartones",n);o.push((0,h.mZ)(e,{vendedorId:this.selectedSeller,estado:"asignado"}))}await Promise.all(o),console.log("Cartones asignados exitosamente"),alert("Cartones asignados exitosamente"),this.fromCarton="",this.toCarton="",await this.loadAvailableCartons(),this.$emit("cartons-asignados")}catch(e){console.error("Error al asignar cartones:",e),alert("Error al asignar cartones: "+e.message)}}}};const he=(0,i.A)(ge,[["render",ue],["__scopeId","data-v-e92b6f42"]]);var me=he;const pe={class:"flex justify-between items-center mb-4"},be=["disabled"],ve={key:0,class:"flex items-center"},fe={key:1},ye={key:0,class:"bg-white p-4 rounded-lg shadow-md mb-6"},xe={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},Ce={class:"text-center"},ke={class:"text-2xl font-bold text-blue-600"},we={class:"text-center"},Le={class:"text-2xl font-bold text-green-600"},Ee={class:"text-center"},Se={class:"text-2xl font-bold text-purple-600"},Pe={class:"mt-4"},Ie={class:"text-gray-600"},_e={class:"text-gray-600"},Ae={key:1,class:"text-center text-gray-600"},Me={key:2},Ue={key:0,class:"text-gray-600"},Xe={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Te=["onClick"],$e=["src","alt","onError"],De={class:"text-gray-800 font-medium"},Ve={class:"text-gray-600"},je={key:1,class:"mt-4 flex justify-center items-center space-x-4"},Fe=["disabled"],Oe={class:"text-gray-700"},Qe=["disabled"],Ge={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},He={class:"bg-white p-6 rounded-lg shadow-lg max-w-lg w-full"},Je=["src","alt"],Re={class:"text-gray-800 font-medium"},Ne={class:"text-gray-600"},ze={class:"mt-4 flex justify-end space-x-4"},We={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Be={class:"bg-white p-6 rounded-lg shadow-lg max-w-lg w-full"},qe={class:"text-gray-600"},Ke={class:"mt-4 flex justify-end space-x-4"};function Ze(e,t,a,r,o,n){return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.Lk)("div",pe,[t[10]||(t[10]=(0,s.Lk)("h2",{class:"text-xl font-semibold text-gray-800"},"Lista de Cartones",-1)),(0,s.Lk)("div",null,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.loadData&&n.loadData(...e)),class:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition mr-2 flex items-center",disabled:o.loading},[o.loading?((0,s.uX)(),(0,s.CE)("span",ve,t[9]||(t[9]=[(0,s.Lk)("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",viewBox:"0 0 24 24"},[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),(0,s.eW)(" Cargando... ")]))):((0,s.uX)(),(0,s.CE)("span",fe,"Refrescar"))],8,be),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.downloadReport&&n.downloadReport(...e)),class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition flex items-center"}," Descargar Reporte ")])]),o.loading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",ye,[t[14]||(t[14]=(0,s.Lk)("h3",{class:"text-xl font-medium text-gray-700 mb-2"},"Estadísticas",-1)),(0,s.Lk)("div",xe,[(0,s.Lk)("div",Ce,[t[11]||(t[11]=(0,s.Lk)("p",{class:"text-gray-600"},"Cartones Disponibles",-1)),(0,s.Lk)("p",ke,(0,y.v_)(o.availableCartons),1)]),(0,s.Lk)("div",we,[t[12]||(t[12]=(0,s.Lk)("p",{class:"text-gray-600"},"Cartones Vendidos",-1)),(0,s.Lk)("p",Le,(0,y.v_)(o.soldCartons),1)]),(0,s.Lk)("div",Ee,[t[13]||(t[13]=(0,s.Lk)("p",{class:"text-gray-600"},"Vendedores",-1)),(0,s.Lk)("p",Se,(0,y.v_)(o.sellerCount),1)])]),(0,s.Lk)("div",Pe,[(0,s.Lk)("p",Ie,"Total de Cartones: "+(0,y.v_)(o.totalCartons),1),(0,s.Lk)("p",_e,"Cartones Asignados: "+(0,y.v_)(o.assignedCartons),1)])])),o.loading?((0,s.uX)(),(0,s.CE)("div",Ae,"Cargando cartones...")):((0,s.uX)(),(0,s.CE)("div",Me,[0===o.cartones.length?((0,s.uX)(),(0,s.CE)("p",Ue,"No hay cartones disponibles.")):(0,s.Q3)("",!0),(0,s.Lk)("div",Xe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.paginatedCartons,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"carton-item bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition cursor-pointer",onClick:t=>n.openModal(e)},[(0,s.Lk)("img",{src:e.imageUrl,alt:"Cartón "+e.serial,class:"carton-image w-full h-48 object-cover rounded-md mb-2",onError:t=>n.handleImageError(e)},null,40,$e),(0,s.Lk)("p",De,[t[15]||(t[15]=(0,s.Lk)("strong",null,"Serial:",-1)),(0,s.eW)(" "+(0,y.v_)(e.serial),1)]),(0,s.Lk)("p",Ve,[t[16]||(t[16]=(0,s.Lk)("strong",null,"Estado:",-1)),(0,s.eW)(" "+(0,y.v_)(e.estado),1)])],8,Te)))),128))]),n.totalPages>1?((0,s.uX)(),(0,s.CE)("div",je,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.previousPage&&n.previousPage(...e)),disabled:1===o.currentPage,class:(0,y.C4)(["bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 transition",{"cursor-not-allowed opacity-50":1===o.currentPage}])}," Anterior ",10,Fe),(0,s.Lk)("span",Oe,"Página "+(0,y.v_)(o.currentPage)+" de "+(0,y.v_)(n.totalPages),1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.nextPage&&n.nextPage(...e)),disabled:o.currentPage===n.totalPages,class:(0,y.C4)(["bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 transition",{"cursor-not-allowed opacity-50":o.currentPage===n.totalPages}])}," Siguiente ",10,Qe)])):(0,s.Q3)("",!0)])),o.selectedCarton?((0,s.uX)(),(0,s.CE)("div",Ge,[(0,s.Lk)("div",He,[t[19]||(t[19]=(0,s.Lk)("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"Detalles del Cartón",-1)),(0,s.Lk)("img",{src:o.selectedCarton.imageUrl,alt:"Cartón "+o.selectedCarton.serial,class:"w-full h-auto rounded-md mb-4",onError:t[4]||(t[4]=e=>n.handleImageError(o.selectedCarton))},null,40,Je),(0,s.Lk)("p",Re,[t[17]||(t[17]=(0,s.Lk)("strong",null,"Serial:",-1)),(0,s.eW)(" "+(0,y.v_)(o.selectedCarton.serial),1)]),(0,s.Lk)("p",Ne,[t[18]||(t[18]=(0,s.Lk)("strong",null,"Estado:",-1)),(0,s.eW)(" "+(0,y.v_)(o.selectedCarton.estado),1)]),(0,s.Lk)("div",ze,["asignado"===o.selectedCarton.estado?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[5]||(t[5]=(...e)=>n.confirmMakeAvailable&&n.confirmMakeAvailable(...e)),class:"bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 transition"}," Devolver a Disponible ")):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>n.closeModal&&n.closeModal(...e)),class:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"}," Cerrar ")])])])):(0,s.Q3)("",!0),o.showConfirm?((0,s.uX)(),(0,s.CE)("div",We,[(0,s.Lk)("div",Be,[t[20]||(t[20]=(0,s.Lk)("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"Confirmar Acción",-1)),(0,s.Lk)("p",qe,"¿Estás seguro de que deseas devolver el cartón con serial "+(0,y.v_)(o.selectedCarton.serial)+" a disponible? Esto permitirá asignarlo a otro vendedor.",1),(0,s.Lk)("div",Ke,[(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>n.cancelMakeAvailable&&n.cancelMakeAvailable(...e)),class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition"}," Cancelar "),(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>n.makeAvailable&&n.makeAvailable(...e)),class:"bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 transition"}," Confirmar ")])])])):(0,s.Q3)("",!0)])}var Ye={data(){return{cartones:[],selectedCarton:null,availableCartons:0,soldCartons:0,assignedCartons:0,totalCartons:0,sellerCount:0,loading:!1,showConfirm:!1,currentPage:1,itemsPerPage:8,unsubscribeCartons:null,unsubscribeSellers:null}},computed:{totalPages(){return Math.ceil(this.cartones.length/this.itemsPerPage)},paginatedCartons(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.cartones.slice(e,t)}},async mounted(){await this.loadData()},beforeUnmount(){this.unsubscribeCartons&&this.unsubscribeCartons(),this.unsubscribeSellers&&this.unsubscribeSellers()},methods:{async loadData(){this.loading=!0;try{await this.loadCartones(),await this.loadSellers()}catch(e){console.error("Error al cargar datos:",e),alert("Error al cargar datos: "+e.message)}finally{this.loading=!1}},async loadCartones(){try{const e=(0,h.rJ)(v,"cartones");this.unsubscribeCartons=(0,h.aQ)(e,(e=>{this.cartones=e.docs.map((e=>({id:e.id,...e.data()}))),this.cartones.sort(((e,t)=>{const a=parseInt(e.serial.replace("LM",""),10),r=parseInt(t.serial.replace("LM",""),10);return a-r})),this.availableCartons=this.cartones.filter((e=>"disponible"===e.estado)).length,this.soldCartons=this.cartones.filter((e=>"vendido"===e.estado)).length,this.assignedCartons=this.cartones.filter((e=>"asignado"===e.estado)).length,this.totalCartons=this.cartones.length,console.log("Cartones cargados:",this.cartones),this.loading=!1}),(e=>{throw console.error("Error al escuchar cartones:",e),e}))}catch(e){throw console.error("Error al cargar los cartones:",e),e}},async loadSellers(){try{const e=(0,h.rJ)(v,"vendedores");this.unsubscribeSellers=(0,h.aQ)(e,(e=>{this.sellerCount=e.docs.length}),(e=>{throw console.error("Error al escuchar vendedores:",e),e}))}catch(e){throw console.error("Error al cargar los vendedores:",e),e}},openModal(e){this.selectedCarton=e},closeModal(){this.selectedCarton=null,this.showConfirm=!1},handleImageError(e){console.error(`Error al cargar la imagen del cartón ${e.serial}:`,e.imageUrl),e.imageUrl=null},confirmMakeAvailable(){this.showConfirm=!0},cancelMakeAvailable(){this.showConfirm=!1},async makeAvailable(){if(this.selectedCarton)try{console.log("Devolviendo cartón a disponible:",this.selectedCarton.id);const e=(0,h.H9)(v,"cartones",this.selectedCarton.id);await(0,h.mZ)(e,{vendedorId:null,estado:"disponible"}),console.log("Cartón devuelto a disponible exitosamente"),alert("Cartón devuelto a disponible exitosamente"),this.showConfirm=!1,this.selectedCarton=null,await this.loadData()}catch(e){console.error("Error al devolver cartón a disponible:",e),alert("Error al devolver cartón a disponible: "+e.message)}},previousPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},downloadReport(){const e=`\n        Reporte de Cartones - ${(new Date).toLocaleDateString()}\n        ======================================\n        Total de Cartones: ${this.totalCartons}\n        Cartones Disponibles: ${this.availableCartons}\n        Cartones Vendidos: ${this.soldCartons}\n        Cartones Asignados: ${this.assignedCartons}\n        Total de Vendedores: ${this.sellerCount}\n        ======================================\n        Detalle de Cartones:\n        ${this.cartones.map((e=>`Serial: ${e.serial}, Estado: ${e.estado}`)).join("\n")}\n      `,t=new Blob([e],{type:"text/plain"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`reporte_cartones_${(new Date).toISOString().split("T")[0]}.txt`,r.click(),window.URL.revokeObjectURL(a)}}};const et=(0,i.A)(Ye,[["render",Ze],["__scopeId","data-v-2da1115f"]]);var tt=et;const at={class:"bg-white p-6 rounded-lg shadow-md"},rt={class:"flex justify-between items-center mb-4"},st={key:0,class:"text-center text-gray-600"},ot={key:1,class:"text-gray-600"},nt={key:2,class:"space-y-4"},lt={class:"text-lg font-medium text-gray-700"},it={class:"text-sm text-gray-500"},dt={class:"text-sm text-gray-500"},ct=["onClick"],ut={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"},gt={class:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full"},ht={class:"text-xl font-semibold text-gray-800 mb-4"},mt={class:"space-y-2"},pt={key:0},bt={key:1},vt={class:"list-disc pl-5"},ft=["onClick"],yt={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},xt={class:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full"},Ct={class:"flex justify-end space-x-4"};function kt(e,t,a,o,n,l){return(0,s.uX)(),(0,s.CE)("div",at,[(0,s.Lk)("div",rt,[t[7]||(t[7]=(0,s.Lk)("h2",{class:"text-xl font-semibold text-gray-800"},"Lista de Vendedores",-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=e=>n.showAddModal=!0),class:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition"}," Agregar Vendedor ")]),n.loading?((0,s.uX)(),(0,s.CE)("div",st,"Cargando vendedores...")):0===n.sellers.length?((0,s.uX)(),(0,s.CE)("div",ot,"No hay vendedores registrados.")):((0,s.uX)(),(0,s.CE)("div",nt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.sellers,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"border p-4 rounded-md flex justify-between items-center"},[(0,s.Lk)("div",null,[(0,s.Lk)("p",lt,(0,y.v_)(e.nombre||e.id||"Sin nombre"),1),(0,s.Lk)("p",it,"Saldo Generado: $"+(0,y.v_)(e.saldoGenerado||0),1),(0,s.Lk)("p",dt,"Cartones Asignados: "+(0,y.v_)(e.assignedCartons),1)]),(0,s.Lk)("button",{onClick:t=>l.showSellerDetails(e),class:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"}," Ver Detalles ",8,ct)])))),128))])),n.selectedSeller?((0,s.uX)(),(0,s.CE)("div",ut,[(0,s.Lk)("div",gt,[(0,s.Lk)("h3",ht,(0,y.v_)(n.selectedSeller.nombre||n.selectedSeller.id||"Sin nombre"),1),(0,s.Lk)("div",mt,[(0,s.Lk)("p",null,[t[8]||(t[8]=(0,s.Lk)("strong",null,"Cartones Asignados:",-1)),(0,s.eW)(" "+(0,y.v_)(n.assignedCartons.length),1)]),0===n.assignedCartons.length?((0,s.uX)(),(0,s.CE)("p",pt,"No hay cartones asignados.")):((0,s.uX)(),(0,s.CE)("div",bt,[(0,s.Lk)("ul",vt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.assignedCartons,(e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id},[(0,s.eW)((0,y.v_)(e.serial)+" ",1),(0,s.Lk)("button",{onClick:t=>l.sellCarton(e.id),class:"ml-2 bg-green-500 text-white px-2 py-1 rounded-md hover:bg-green-600 transition"}," Vender ",8,ft)])))),128))])])),(0,s.Lk)("p",null,[t[9]||(t[9]=(0,s.Lk)("strong",null,"Cartones Vendidos:",-1)),(0,s.eW)(" "+(0,y.v_)(n.soldCartons.length),1)]),(0,s.Lk)("p",null,[t[10]||(t[10]=(0,s.Lk)("strong",null,"Cartones Disponibles (Global):",-1)),(0,s.eW)(" "+(0,y.v_)(n.availableCartons.length),1)]),(0,s.Lk)("p",null,[t[11]||(t[11]=(0,s.Lk)("strong",null,"Saldo Generado:",-1)),(0,s.eW)(" $"+(0,y.v_)(n.selectedSeller.saldoGenerado||0),1)])]),(0,s.Lk)("button",{onClick:t[1]||(t[1]=e=>n.selectedSeller=null),class:"bg-indigo-600 text-white px-4 py-2 rounded-md mt-4 hover:bg-indigo-700 transition"}," Cerrar ")])])):(0,s.Q3)("",!0),n.showAddModal?((0,s.uX)(),(0,s.CE)("div",yt,[(0,s.Lk)("div",xt,[t[16]||(t[16]=(0,s.Lk)("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"Agregar Nuevo Vendedor",-1)),(0,s.Lk)("form",{onSubmit:t[6]||(t[6]=(0,r.D$)(((...e)=>l.addSeller&&l.addSeller(...e)),["prevent"])),class:"space-y-4"},[(0,s.Lk)("div",null,[t[12]||(t[12]=(0,s.Lk)("label",{for:"sellerEmail",class:"block text-sm font-medium text-gray-700"},"Correo",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.newSellerEmail=e),id:"sellerEmail",type:"email",required:"",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300",placeholder:"vendedor1@example.com"},null,512),[[r.Jo,n.newSellerEmail]])]),(0,s.Lk)("div",null,[t[13]||(t[13]=(0,s.Lk)("label",{for:"sellerPassword",class:"block text-sm font-medium text-gray-700"},"Clave",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.newSellerPassword=e),id:"sellerPassword",type:"password",required:"",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300",placeholder:"Ingrese la clave"},null,512),[[r.Jo,n.newSellerPassword]])]),(0,s.Lk)("div",null,[t[14]||(t[14]=(0,s.Lk)("label",{for:"sellerUsername",class:"block text-sm font-medium text-gray-700"},"Nombre de Usuario",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.newSellerUsername=e),id:"sellerUsername",type:"text",required:"",class:"mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300",placeholder:"Nombre del vendedor"},null,512),[[r.Jo,n.newSellerUsername]])]),(0,s.Lk)("div",Ct,[(0,s.Lk)("button",{type:"button",onClick:t[5]||(t[5]=e=>n.showAddModal=!1),class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition"}," Cancelar "),t[15]||(t[15]=(0,s.Lk)("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition"}," Agregar ",-1))])],32)])])):(0,s.Q3)("",!0)])}var wt={data(){return{sellers:[],selectedSeller:null,assignedCartons:[],soldCartons:[],availableCartons:[],loading:!1,showAddModal:!1,newSellerEmail:"",newSellerPassword:"",newSellerUsername:"",unsubscribeSellers:null,unsubscribeAssigned:null,unsubscribeSold:null,unsubscribeAvailable:null}},async mounted(){await this.loadSellers()},beforeUnmount(){this.unsubscribeSellers&&this.unsubscribeSellers(),this.unsubscribeAssigned&&this.unsubscribeAssigned(),this.unsubscribeSold&&this.unsubscribeSold(),this.unsubscribeAvailable&&this.unsubscribeAvailable()},methods:{async loadSellers(){this.loading=!0;try{console.log("Cargando vendedores...");const e=(0,h.rJ)(v,"vendedores");this.unsubscribeSellers=(0,h.aQ)(e,(async e=>{this.sellers=await Promise.all(e.docs.map((async e=>{const t=e.data();console.log("Vendedor cargado (ID: ",e.id,"):",t);const a={id:e.id,...t,vendedorId:t.vendedorId||e.id},r=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",a.id),(0,h._M)("estado","==","asignado")),s=await(0,h.GG)(r);return a.assignedCartons=s.size,a}))),console.log("Vendedores cargados con estadísticas:",this.sellers),this.loading=!1}),(e=>{console.error("Error al escuchar vendedores:",e),alert("Error al cargar vendedores: "+e.message),this.loading=!1}))}catch(e){console.error("Error al cargar los vendedores:",e),alert("Error al cargar vendedores: "+e.message),this.loading=!1}},async showSellerDetails(e){if(console.log("Mostrando detalles del vendedor:",e),this.selectedSeller=e,!e.vendedorId)return console.error("Error: vendedorId no está definido para este vendedor:",e),this.assignedCartons=[],this.soldCartons=[],void(this.availableCartons=[]);await this.loadSellerCartons(e.vendedorId)},async loadSellerCartons(e){try{console.log(`Cargando cartones para el vendedor ${e}...`);const t=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",e),(0,h._M)("estado","==","asignado")),a=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",e),(0,h._M)("estado","==","vendido")),r=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",null),(0,h._M)("estado","==","disponible"));this.unsubscribeAssigned=(0,h.aQ)(t,(e=>{this.assignedCartons=e.docs.map((e=>{const t=e.data();return console.log(`Cartón asignado encontrado (ID: ${e.id}):`,t),{id:e.id,serial:t.serial}})),this.assignedCartons.sort(((e,t)=>{const a=parseInt(e.serial.replace("LM",""),10),r=parseInt(t.serial.replace("LM",""),10);return a-r})),console.log("Cartones asignados:",this.assignedCartons)}),(e=>{console.error("Error al escuchar cartones asignados:",e)})),this.unsubscribeSold=(0,h.aQ)(a,(e=>{this.soldCartons=e.docs.map((e=>({id:e.id,serial:e.data().serial}))),this.soldCartons.sort(((e,t)=>{const a=parseInt(e.serial.replace("LM",""),10),r=parseInt(t.serial.replace("LM",""),10);return a-r})),console.log("Cartones vendidos:",this.soldCartons)}),(e=>{console.error("Error al escuchar cartones vendidos:",e)})),this.unsubscribeAvailable=(0,h.aQ)(r,(e=>{this.availableCartons=e.docs.map((e=>({id:e.id,serial:e.data().serial}))),this.availableCartons.sort(((e,t)=>{const a=parseInt(e.serial.replace("LM",""),10),r=parseInt(t.serial.replace("LM",""),10);return a-r})),console.log("Cartones disponibles (global):",this.availableCartons)}),(e=>{console.error("Error al escuchar cartones disponibles:",e)}))}catch(t){console.error("Error al cargar los cartones del vendedor:",t),this.assignedCartons=[],this.soldCartons=[],this.availableCartons=[]}},async sellCarton(e){try{console.log(`Vendiendo cartón ${e} para el vendedor ${this.selectedSeller.vendedorId}...`);const t=(0,h.H9)(v,"cartones",e);await(0,h.mZ)(t,{estado:"vendido"});const a=(0,h.H9)(v,"vendedores",this.selectedSeller.id),r=this.selectedSeller.saldoGenerado||0;await(0,h.mZ)(a,{saldoGenerado:r+5}),console.log(`Cartón ${e} marcado como vendido`),alert(`Cartón ${e} vendido exitosamente`),this.selectedSeller.saldoGenerado=r+5,await this.loadSellerCartons(this.selectedSeller.vendedorId)}catch(t){console.error("Error al vender el cartón:",t),alert("Error al vender el cartón: "+t.message)}},async addSeller(){if(this.newSellerEmail&&this.newSellerPassword&&this.newSellerUsername)try{const e=await(0,m.eJ)(f,this.newSellerEmail,this.newSellerPassword),t=e.user;await(0,h.BN)((0,h.H9)(v,"vendedores",t.uid),{email:this.newSellerEmail,nombre:this.newSellerUsername,saldoGenerado:0}),console.log("Vendedor agregado exitosamente"),alert("Vendedor agregado exitosamente"),this.newSellerEmail="",this.newSellerPassword="",this.newSellerUsername="",this.showAddModal=!1,await this.loadSellers()}catch(e){console.error("Error al agregar vendedor:",e),alert("Error al agregar vendedor: "+e.message)}else alert("Por favor, complete todos los campos: Correo, Clave y Nombre de Usuario.")}}};const Lt=(0,i.A)(wt,[["render",kt],["__scopeId","data-v-32293f77"]]);var Et=Lt,St={name:"HomePage",components:{UploadCarton:te,AssignCartons:me,CartonList:tt,SellerList:Et},data(){return{inactivityTimeout:null,inactivityLimit:9e5}},mounted(){this.setupInactivityTimer()},beforeUnmount(){this.clearInactivityTimer()},methods:{async checkDuplicates({serials:e,files:t},a){try{const r=(0,h.rJ)(v,"cartones"),s=(0,h.P)(r,(0,h._M)("serial","in",e)),o=await(0,h.GG)(s),n=o.docs.map((e=>e.data().serial)),l=t.filter((e=>!n.includes(e.name.split(".")[0])));a(l)}catch(r){console.error("Error al verificar duplicados:",r),alert("Error al verificar duplicados: "+r.message),a([])}},async handleImagesUploaded(e){let t=0;try{for(const a of e)if(a.serial&&a.imageUrl){const e=await(0,h.gS)((0,h.rJ)(v,"cartones"),{serial:a.serial,imageUrl:a.imageUrl,estado:"disponible",createdAt:new Date,vendedorId:null});console.log(`Cartón ${a.serial} guardado con ID:`,e.id),t++}else if("string"===typeof a){const e=this.selectedFiles.find((e=>e.name.includes(a.split("/").pop().split(".")[0])))?.name.split(".")[0];if(e){const r=await(0,h.gS)((0,h.rJ)(v,"cartones"),{serial:e,imageUrl:a,estado:"disponible",createdAt:new Date,vendedorId:null});console.log(`Cartón ${e} guardado con ID:`,r.id),t++}}alert(`${t} de ${e.length} cartones se guardaron exitosamente en Firestore`)}catch(a){console.error("Error al guardar los cartones:",a),alert(`Error al guardar los cartones: ${a.message}. Se guardaron ${t} de ${e.length} cartones.`)}},async refreshCartones(){this.$refs.cartonList&&"function"===typeof this.$refs.cartonList.loadCartones?await this.$refs.cartonList.loadCartones():console.warn("loadCartones no está disponible en CartonList")},async logout(){try{await(0,m.CI)(f),this.$router.push("/login"),console.log("Sesión cerrada con éxito"),this.clearInactivityTimer()}catch(e){console.error("Error al cerrar sesión:",e),alert("Error al cerrar sesión: "+e.message)}},setupInactivityTimer(){const e=["mousemove","keydown","click","scroll"],t=()=>{this.clearInactivityTimer(),this.inactivityTimeout=setTimeout((()=>{this.logout(),alert("Sesión cerrada por inactividad de 15 minutos.")}),this.inactivityLimit)};e.forEach((e=>{window.addEventListener(e,t)})),t()},clearInactivityTimer(){const e=["mousemove","keydown","click","scroll"];e.forEach((e=>{window.removeEventListener(e,(()=>{}))})),this.inactivityTimeout&&(clearTimeout(this.inactivityTimeout),this.inactivityTimeout=null)}}};const Pt=(0,i.A)(St,[["render",F],["__scopeId","data-v-241980c6"]]);var It=Pt;const _t={class:"min-h-screen bg-gradient-to-br from-indigo-100 to-purple-200 p-6"},At={class:"flex justify-between items-center mb-8"},Mt={class:"text-3xl font-bold text-gray-900 animate-fade-in"},Ut={class:"bg-white p-6 rounded-xl shadow-lg mb-8 grid grid-cols-1 sm:grid-cols-4 gap-6"},Xt={class:"text-center p-4 bg-blue-50 rounded-lg transition-transform hover:scale-105"},Tt={class:"text-3xl font-bold text-blue-600 mt-2"},$t={class:"text-center p-4 bg-blue-50 rounded-lg transition-transform hover:scale-105"},Dt={class:"text-3xl font-bold text-blue-600 mt-2"},Vt={class:"text-center p-4 bg-green-50 rounded-lg transition-transform hover:scale-105"},jt={class:"text-3xl font-bold text-green-600 mt-2"},Ft={class:"text-center p-4 bg-purple-50 rounded-lg transition-transform hover:scale-105"},Ot={class:"text-3xl font-bold text-purple-600 mt-2"},Qt={class:"bg-white p-6 rounded-xl shadow-lg mb-8"},Gt={class:"flex flex-col sm:flex-row gap-4 mb-6"},Ht=["disabled"],Jt={key:0,class:"flex items-center"},Rt={key:1},Nt={key:0,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in"},zt={class:"bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full transform transition-all duration-300 hover:scale-105"},Wt=["src","alt"],Bt={class:"text-gray-800 font-medium text-center"},qt={class:"mt-6 flex justify-center space-x-6"},Kt={key:1,class:"relative mt-6"},Zt={ref:"video",class:"w-full max-w-md rounded-lg shadow-md",autoplay:""},Yt={ref:"canvas",class:"hidden"},ea={class:"bg-white p-6 rounded-xl shadow-lg"},ta={key:0,class:"text-gray-600 text-center py-4"},aa={key:1,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},ra=["src","alt","onError"],sa={class:"p-2"},oa={class:"text-gray-800 font-medium text-center text-sm"},na={class:"text-gray-600 text-center text-xs"},la={class:"flex justify-between items-center mt-6"},ia=["disabled"],da={class:"text-gray-700"},ca=["disabled"];function ua(e,t,a,o,n,l){return(0,s.uX)(),(0,s.CE)("div",_t,[(0,s.Lk)("div",At,[(0,s.Lk)("h1",Mt," Dashboard de "+(0,y.v_)(n.sellerName||"Vendedor"),1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.logout&&l.logout(...e)),class:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-300"}," Cerrar Sesión ")]),(0,s.Lk)("div",Ut,[(0,s.Lk)("div",Xt,[t[9]||(t[9]=(0,s.Lk)("p",{class:"text-gray-600 font-medium"},"Cartones Asignados",-1)),(0,s.Lk)("p",Tt,(0,y.v_)(n.allCartons.length),1)]),(0,s.Lk)("div",$t,[t[10]||(t[10]=(0,s.Lk)("p",{class:"text-gray-600 font-medium"},"Cartones Disponibles",-1)),(0,s.Lk)("p",Dt,(0,y.v_)(n.availableCartons.length),1)]),(0,s.Lk)("div",Vt,[t[11]||(t[11]=(0,s.Lk)("p",{class:"text-gray-600 font-medium"},"Cartones Vendidos",-1)),(0,s.Lk)("p",jt,(0,y.v_)(n.soldCartons.length),1)]),(0,s.Lk)("div",Ft,[t[12]||(t[12]=(0,s.Lk)("p",{class:"text-gray-600 font-medium"},"Saldo Generado ($)",-1)),(0,s.Lk)("p",Ot,(0,y.v_)(n.saldoGenerado),1)])]),(0,s.Lk)("div",Qt,[t[15]||(t[15]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-6"},"Vender Cartón",-1)),(0,s.Lk)("div",Gt,[(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.startQRScanner&&l.startQRScanner(...e)),class:"bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition duration-300 flex items-center justify-center w-full sm:w-auto",disabled:n.scanning},[n.scanning?((0,s.uX)(),(0,s.CE)("span",Jt,t[13]||(t[13]=[(0,s.Lk)("svg",{class:"animate-spin h-5 w-5 mr-2 text-white",viewBox:"0 0 24 24"},[(0,s.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),(0,s.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),(0,s.eW)(" Escaneando... ")]))):((0,s.uX)(),(0,s.CE)("span",Rt,"Escanear QR"))],8,Ht),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.manualSerial=e),type:"text",placeholder:"Ingresar Serial Manualmente",class:"border border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300 w-full sm:w-1/2",onKeyup:t[3]||(t[3]=(0,r.jR)(((...e)=>l.checkCarton&&l.checkCarton(...e)),["enter"]))},null,544),[[r.Jo,n.manualSerial]])]),n.selectedCarton?((0,s.uX)(),(0,s.CE)("div",Nt,[(0,s.Lk)("div",zt,[t[14]||(t[14]=(0,s.Lk)("h3",{class:"text-2xl font-semibold text-gray-800 mb-4 text-center"},"Confirmar Venta",-1)),(0,s.Lk)("img",{src:n.selectedCarton.imageUrl,alt:"Cartón "+n.selectedCarton.serial,class:"w-full h-auto object-contain rounded-lg mb-4",onError:t[4]||(t[4]=e=>l.handleImageError(n.selectedCarton)),style:{"max-height":"200px"}},null,40,Wt),(0,s.Lk)("p",Bt,"Serial: "+(0,y.v_)(n.selectedCarton.serial),1),(0,s.Lk)("div",qt,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>l.cancelSale&&l.cancelSale(...e)),class:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-300"}," Cancelar "),(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>l.confirmSale&&l.confirmSale(...e)),class:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition duration-300"}," Vender ")])])])):(0,s.Q3)("",!0),n.scanning?((0,s.uX)(),(0,s.CE)("div",Kt,[(0,s.Lk)("video",Zt,null,512),(0,s.Lk)("canvas",Yt,null,512)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",ea,[t[16]||(t[16]=(0,s.Lk)("h2",{class:"text-2xl font-semibold text-gray-800 mb-6"},"Todos los Cartones",-1)),0===l.paginatedCartons.length?((0,s.uX)(),(0,s.CE)("div",ta,"No hay cartones asignados.")):((0,s.uX)(),(0,s.CE)("div",aa,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.paginatedCartons,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,y.C4)(["bg-white border-2 border-gray-200 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden",{"bg-green-800 bg-opacity-30":"vendido"===e.estado}])},[(0,s.Lk)("img",{src:e.imageUrl,alt:"Cartón "+e.serial,class:"w-full h-auto object-contain",onError:t=>l.handleImageError(e),style:{"max-height":"150px"}},null,40,ra),(0,s.Lk)("div",sa,[(0,s.Lk)("p",oa,"Serial: "+(0,y.v_)(e.serial),1),(0,s.Lk)("p",na,"Estado: "+(0,y.v_)(e.estado),1)])],2)))),128))])),(0,s.Lk)("div",la,[(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>l.prevPage&&l.prevPage(...e)),disabled:1===n.currentPage,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg disabled:opacity-50 hover:bg-gray-400 transition duration-300"}," Anterior ",8,ia),(0,s.Lk)("p",da,"Página "+(0,y.v_)(n.currentPage)+" de "+(0,y.v_)(l.totalPages),1),(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>l.nextPage&&l.nextPage(...e)),disabled:n.currentPage===l.totalPages,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg disabled:opacity-50 hover:bg-gray-400 transition duration-300"}," Siguiente ",8,ca)])])])}a(7588);var ga={data(){return{availableCartons:[],soldCartons:[],allCartons:[],saldoGenerado:0,sellerName:"",selectedCarton:null,manualSerial:"",scanning:!1,unsubscribeAvailable:null,unsubscribeSold:null,stream:null,inactivityTimeout:null,currentPage:1,itemsPerPage:10}},computed:{paginatedCartons(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.allCartons.slice(e,t)},totalPages(){return Math.ceil(this.allCartons.length/this.itemsPerPage)}},async mounted(){await this.loadCartons(),await this.loadUserData(),this.setupInactivityTimer(),this.resetInactivityTimer(),["click","mousemove","keydown","touchstart"].forEach((e=>{window.addEventListener(e,this.resetInactivityTimer)}))},beforeUnmount(){this.unsubscribeAvailable&&this.unsubscribeAvailable(),this.unsubscribeSold&&this.unsubscribeSold(),this.stream&&this.stream.getTracks().forEach((e=>e.stop())),this.inactivityTimeout&&clearTimeout(this.inactivityTimeout),["click","mousemove","keydown","touchstart"].forEach((e=>{window.removeEventListener(e,this.resetInactivityTimer)}))},methods:{async loadCartons(){const e=f.currentUser;if(!e)return;const t=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",e.uid),(0,h._M)("estado","==","asignado"));this.unsubscribeAvailable=(0,h.aQ)(t,(e=>{this.availableCartons=e.docs.map((e=>({id:e.id,...e.data()}))),this.updateAllCartons()}),(e=>console.error("Error al cargar cartones disponibles:",e)));const a=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("vendedorId","==",e.uid),(0,h._M)("estado","==","vendido"));this.unsubscribeSold=(0,h.aQ)(a,(e=>{this.soldCartons=e.docs.map((e=>({id:e.id,...e.data()}))),this.updateAllCartons()}),(e=>console.error("Error al cargar cartones vendidos:",e)))},updateAllCartons(){this.allCartons=[...this.availableCartons,...this.soldCartons].sort(((e,t)=>e.serial.localeCompare(t.serial))),this.currentPage=1},async loadUserData(){const e=f.currentUser;if(!e)return;const t=(0,h.H9)(v,"vendedores",e.uid);(0,h.aQ)(t,(e=>{if(e.exists()){const t=e.data();this.saldoGenerado=t.saldoGenerado||0,this.sellerName=t.nombre||"Vendedor"}}),(e=>console.error("Error al cargar datos del vendedor:",e)))},setupInactivityTimer(){this.inactivityTimeout=setTimeout((()=>this.logout()),9e5)},resetInactivityTimer(){this.inactivityTimeout&&clearTimeout(this.inactivityTimeout),this.inactivityTimeout=setTimeout((()=>this.logout()),9e5)},async logout(){try{await f.signOut(),this.$router.push("/login")}catch(e){console.error("Error al cerrar sesión:",e),alert("Error al cerrar sesión: "+e.message)}},async startQRScanner(){this.scanning=!0;const e=this.$refs.video,t=this.$refs.canvas;try{this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),e.srcObject=this.stream,e.play();const a=()=>{if(e.readyState===e.HAVE_ENOUGH_DATA){t.height=e.videoHeight,t.width=e.videoWidth;const a=t.getContext("2d");a.drawImage(e,0,0,t.width,t.height);const r=a.getImageData(0,0,t.width,t.height),s=window.jsQR(r.data,r.width,r.height);s&&(this.manualSerial=s.data,this.checkCarton(),this.stopQRScanner())}this.scanning&&requestAnimationFrame(a)};requestAnimationFrame(a)}catch(a){console.error("Error al acceder a la cámara:",a),alert("No se pudo acceder a la cámara. Asegúrate de otorgar permisos."),this.scanning=!1}},stopQRScanner(){this.stream&&this.stream.getTracks().forEach((e=>e.stop())),this.scanning=!1,this.$refs.video.srcObject=null},async checkCarton(){const e=this.manualSerial.trim();if(!e)return;const t=(0,h.P)((0,h.rJ)(v,"cartones"),(0,h._M)("serial","==",e),(0,h._M)("vendedorId","==",f.currentUser.uid),(0,h._M)("estado","==","asignado")),a=await(0,h.GG)(t);a.empty?(alert("Cartón no encontrado o no disponible para este vendedor."),this.manualSerial=""):(this.selectedCarton={id:a.docs[0].id,...a.docs[0].data()},this.manualSerial="")},async confirmSale(){if(this.selectedCarton)try{const e=(0,h.H9)(v,"cartones",this.selectedCarton.id);await(0,h.mZ)(e,{estado:"vendido"});const t=(0,h.H9)(v,"vendedores",f.currentUser.uid),a=this.saldoGenerado+5;await(0,h.mZ)(t,{saldoGenerado:a}),this.saldoGenerado=a,this.selectedCarton=null,await this.loadCartons()}catch(e){console.error("Error al vender el cartón:",e),alert("Error al vender el cartón: "+e.message)}},cancelSale(){this.selectedCarton=null},handleImageError(e){console.error(`Error al cargar la imagen del cartón ${e.serial}:`,e.imageUrl),e.imageUrl=null},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++}}};const ha=(0,i.A)(ga,[["render",ua],["__scopeId","data-v-ff3f46fc"]]);var ma=ha;const pa=[{path:"/login",name:"LoginPage",component:_},{path:"/",name:"HomePage",component:It,meta:{requiresAuth:!0,role:"admin"}},{path:"/vendedor",name:"SellerDashboard",component:ma,meta:{requiresAuth:!0,role:"seller"}}],ba=(0,u.aE)({history:(0,u.LA)(),routes:pa});ba.beforeEach((async(e,t,a)=>{const r=e.matched.some((e=>e.meta.requiresAuth)),s=e.meta.role,o=await new Promise((e=>{const t=f.onAuthStateChanged((a=>{t(),e(a)}))}));if(!o&&r)return a("/login");if(o){if("/login"===e.path){const e="master1@example.com"===o.email,t=await(0,h.x7)((0,h.H9)(v,"vendedores",o.uid)),r=t.exists();return e?a("/"):r?a("/vendedor"):(await f.signOut(),a("/login"))}if(r&&s){const e="master1@example.com"===o.email,t=await(0,h.x7)((0,h.H9)(v,"vendedores",o.uid)),r=t.exists();return"admin"===s&&e||"seller"===s&&r?a():(await f.signOut(),a(e?"/":r?"/vendedor":"/login"))}}return a()}));var va=ba,fa=a(7411);a(7917);const ya=(0,r.Ef)(c);(0,m.oM)(f,m.F0).then((()=>{console.log("Persistencia de sesión configurada correctamente"),ya.use(va),ya.use(fa.Ay,{transition:"Vue-Toastification__bounce",maxToasts:20,newestOnTop:!0,position:"top-right",timeout:3e3,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!1,closeButton:"button",icon:!0,rtl:!1}),ya.mount("#app")})).catch((e=>{console.error("Error al configurar persistencia:",e),ya.use(va),ya.use(fa.Ay,{transition:"Vue-Toastification__bounce",maxToasts:20,newestOnTop:!0,position:"top-right",timeout:3e3,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!1,closeButton:"button",icon:!0,rtl:!1}),ya.mount("#app")}))}},t={};function a(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,r,s,o){if(!r){var n=1/0;for(c=0;c<e.length;c++){r=e[c][0],s=e[c][1],o=e[c][2];for(var l=!0,i=0;i<r.length;i++)(!1&o||n>=o)&&Object.keys(a.O).every((function(e){return a.O[e](r[i])}))?r.splice(i--,1):(l=!1,o<n&&(n=o));if(l){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[r,s,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,r){var s,o,n=r[0],l=r[1],i=r[2],d=0;if(n.some((function(t){return 0!==e[t]}))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(i)var c=i(a)}for(t&&t(r);d<n.length;d++)o=n[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},r=self["webpackChunkventa_cartones"]=self["webpackChunkventa_cartones"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=a.O(void 0,[504],(function(){return a(8743)}));r=a.O(r)})();
//# sourceMappingURL=app.4f4558f7.js.map